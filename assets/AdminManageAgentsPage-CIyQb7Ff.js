const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CDuOHj3I.js","assets/index-DSUr7664.css"])))=>i.map(i=>d[i]);
import{r as p,j as e,v as cr,bj as Ct,bx as dr,by as ys,bz as ts,bA as ur,bB as hr,bC as mr,bD as ye,bE as Ns,bF as fr,bG as pr,bH as gr,bI as Et,A as vs,bJ as Ut,bp as it,aJ as ss,bt as rs,bK as ns,bL as as,V as xr,bM as br,bN as jr,aV as E,bO as _r,bP as ws,D as yr,aA as Nr,a9 as St,bQ as Pt,F as kt,bR as is,as as vr,bS as wr,aL as Ur,aa as os,w as Sr,ag as Pr,Y as kr,bT as Ar,bU as Rr,ac as Tr}from"./index-CDuOHj3I.js";import{A as Cr}from"./AdminLayout-B2_HOb6I.js";import{u as Er,c as Fr,d as Dr}from"./adminManageUsersApi-DPG9IZoO.js";import{C as Ir}from"./categories-DXhb4QT0.js";const Or=({title:s,onClose:t,children:n,size:a="medium",hideCloseButton:i=!1})=>{p.useEffect(()=>{const u=g=>{g.key==="Escape"&&t()};return window.addEventListener("keydown",u),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",u),document.body.style.overflow="auto"}},[t]);const l=u=>{u.target===u.currentTarget&&t()};return e.jsx("div",{className:"modal-overlay",onClick:l,children:e.jsxs("div",{className:`modal modal-${a}`,children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:s}),!i&&e.jsx("button",{className:"modal-close-btn",onClick:t,"aria-label":"Close modal",children:e.jsx(cr,{})})]}),e.jsx("div",{className:"modal-content",children:n})]})})},ls="authToken",Us=()=>{let s=localStorage.getItem(ls);return s||(s=sessionStorage.getItem(ls)),s&&!s.startsWith("Bearer ")&&(s=`Bearer ${s}`),s},Dt=()=>{const s=Us(),t={"Content-Type":"application/json"};return s&&(t.Authorization=s),console.log("Generated auth headers:",{Authorization:s?`${s.substring(0,15)}...`:void 0}),t};function Lr(){const s=localStorage.getItem("authToken");if(!s)return!1;try{const t=s.split(".")[1],n=JSON.parse(atob(t)),a=Math.floor(Date.now()/1e3),i=n.exp-a;return i<300,i>0}catch(t){return console.error("Error validating token:",t),!1}}const $r=async s=>{try{const t=Dt(),n=s.split("?")[0],a=s.includes("?")?"":`?_=${Date.now()}`,i=await fetch(`${Ct}/api/agent/${n}/price${a}`,{method:"GET",headers:{...t,"Content-Type":"application/json"},credentials:"include"});if(!i.ok)throw new Error(`Failed to fetch price data. Status: ${i.status}`);return await i.json()}catch(t){return console.error("Error fetching agent price:",t),{id:s.split("?")[0],price:9.99,currency:"USD",subscription:!0,interval:"month",mock:!0}}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ss="firebasestorage.googleapis.com",Ps="storageBucket",Mr=120*1e3,Br=600*1e3,qr=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D extends mr{constructor(t,n,a=0){super(At(t),`Firebase Storage: ${n} (${At(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,D.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return At(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var F;(function(s){s.UNKNOWN="unknown",s.OBJECT_NOT_FOUND="object-not-found",s.BUCKET_NOT_FOUND="bucket-not-found",s.PROJECT_NOT_FOUND="project-not-found",s.QUOTA_EXCEEDED="quota-exceeded",s.UNAUTHENTICATED="unauthenticated",s.UNAUTHORIZED="unauthorized",s.UNAUTHORIZED_APP="unauthorized-app",s.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",s.INVALID_CHECKSUM="invalid-checksum",s.CANCELED="canceled",s.INVALID_EVENT_NAME="invalid-event-name",s.INVALID_URL="invalid-url",s.INVALID_DEFAULT_BUCKET="invalid-default-bucket",s.NO_DEFAULT_BUCKET="no-default-bucket",s.CANNOT_SLICE_BLOB="cannot-slice-blob",s.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",s.NO_DOWNLOAD_URL="no-download-url",s.INVALID_ARGUMENT="invalid-argument",s.INVALID_ARGUMENT_COUNT="invalid-argument-count",s.APP_DELETED="app-deleted",s.INVALID_ROOT_OPERATION="invalid-root-operation",s.INVALID_FORMAT="invalid-format",s.INTERNAL_ERROR="internal-error",s.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(F||(F={}));function At(s){return"storage/"+s}function It(){const s="An unknown error occurred, please check the error payload for server response.";return new D(F.UNKNOWN,s)}function zr(s){return new D(F.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")}function Hr(s){return new D(F.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Gr(){const s="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new D(F.UNAUTHENTICATED,s)}function Wr(){return new D(F.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Jr(s){return new D(F.UNAUTHORIZED,"User does not have permission to access '"+s+"'.")}function ks(){return new D(F.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function As(){return new D(F.CANCELED,"User canceled the upload/download.")}function Vr(s){return new D(F.INVALID_URL,"Invalid URL '"+s+"'.")}function Xr(s){return new D(F.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+s+"'.")}function Kr(){return new D(F.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Ps+"' property when initializing the app?")}function Rs(){return new D(F.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Yr(){return new D(F.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function Zr(){return new D(F.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Qr(s){return new D(F.UNSUPPORTED_ENVIRONMENT,`${s} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Le(s){return new D(F.INVALID_ARGUMENT,s)}function Ts(){return new D(F.APP_DELETED,"The Firebase app was deleted.")}function Cs(s){return new D(F.INVALID_ROOT_OPERATION,"The operation '"+s+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Ve(s,t){return new D(F.INVALID_FORMAT,"String does not match format '"+s+"': "+t)}function Je(s){throw new D(F.INTERNAL_ERROR,"Internal error: "+s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K{constructor(t,n){this.bucket=t,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,n){let a;try{a=K.makeFromUrl(t,n)}catch{return new K(t,"")}if(a.path==="")return a;throw Xr(t)}static makeFromUrl(t,n){let a=null;const i="([A-Za-z0-9.\\-_]+)";function l(k){k.path.charAt(k.path.length-1)==="/"&&(k.path_=k.path_.slice(0,-1))}const u="(/(.*))?$",g=new RegExp("^gs://"+i+u,"i"),m={bucket:1,path:3};function y(k){k.path_=decodeURIComponent(k.path)}const _="v[A-Za-z0-9_]+",P=n.replace(/[.]/g,"\\."),w="(/([^?#]*).*)?$",A=new RegExp(`^https?://${P}/${_}/b/${i}/o${w}`,"i"),T={bucket:1,path:3},$=n===Ss?"(?:storage.googleapis.com|storage.cloud.google.com)":n,N="([^?#]*)",Y=new RegExp(`^https?://${$}/${i}/${N}`,"i"),I=[{regex:g,indices:m,postModify:l},{regex:A,indices:T,postModify:y},{regex:Y,indices:{bucket:1,path:2},postModify:y}];for(let k=0;k<I.length;k++){const W=I[k],q=W.regex.exec(t);if(q){const ie=q[W.indices.bucket];let R=q[W.indices.path];R||(R=""),a=new K(ie,R),W.postModify(a);break}}if(a==null)throw Vr(t);return a}}class en{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tn(s,t,n){let a=1,i=null,l=null,u=!1,g=0;function m(){return g===2}let y=!1;function _(...N){y||(y=!0,t.apply(null,N))}function P(N){i=setTimeout(()=>{i=null,s(A,m())},N)}function w(){l&&clearTimeout(l)}function A(N,...Y){if(y){w();return}if(N){w(),_.call(null,N,...Y);return}if(m()||u){w(),_.call(null,N,...Y);return}a<64&&(a*=2);let I;g===1?(g=2,I=0):I=(a+Math.random())*1e3,P(I)}let T=!1;function $(N){T||(T=!0,w(),!y&&(i!==null?(N||(g=2),clearTimeout(i),P(0)):N||(g=1)))}return P(0),l=setTimeout(()=>{u=!0,$(!0)},n),$}function sn(s){s(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rn(s){return s!==void 0}function nn(s){return typeof s=="function"}function an(s){return typeof s=="object"&&!Array.isArray(s)}function ut(s){return typeof s=="string"||s instanceof String}function cs(s){return Ot()&&s instanceof Blob}function Ot(){return typeof Blob<"u"}function Ft(s,t,n,a){if(a<t)throw Le(`Invalid value for '${s}'. Expected ${t} or greater.`);if(a>n)throw Le(`Invalid value for '${s}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(s,t,n){let a=t;return n==null&&(a=`https://${t}`),`${n}://${a}/v0${s}`}function Es(s){const t=encodeURIComponent;let n="?";for(const a in s)if(s.hasOwnProperty(a)){const i=t(a)+"="+t(s[a]);n=n+i+"&"}return n=n.slice(0,-1),n}var Pe;(function(s){s[s.NO_ERROR=0]="NO_ERROR",s[s.NETWORK_ERROR=1]="NETWORK_ERROR",s[s.ABORT=2]="ABORT"})(Pe||(Pe={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fs(s,t){const n=s>=500&&s<600,i=[408,429].indexOf(s)!==-1,l=t.indexOf(s)!==-1;return n||i||l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(t,n,a,i,l,u,g,m,y,_,P,w=!0,A=!1){this.url_=t,this.method_=n,this.headers_=a,this.body_=i,this.successCodes_=l,this.additionalRetryCodes_=u,this.callback_=g,this.errorCallback_=m,this.timeout_=y,this.progressCallback_=_,this.connectionFactory_=P,this.retry=w,this.isUsingEmulator=A,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((T,$)=>{this.resolve_=T,this.reject_=$,this.start_()})}start_(){const t=(a,i)=>{if(i){a(!1,new ot(!1,null,!0));return}const l=this.connectionFactory_();this.pendingConnection_=l;const u=g=>{const m=g.loaded,y=g.lengthComputable?g.total:-1;this.progressCallback_!==null&&this.progressCallback_(m,y)};this.progressCallback_!==null&&l.addUploadProgressListener(u),l.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&l.removeUploadProgressListener(u),this.pendingConnection_=null;const g=l.getErrorCode()===Pe.NO_ERROR,m=l.getStatus();if(!g||Fs(m,this.additionalRetryCodes_)&&this.retry){const _=l.getErrorCode()===Pe.ABORT;a(!1,new ot(!1,null,_));return}const y=this.successCodes_.indexOf(m)!==-1;a(!0,new ot(y,l))})},n=(a,i)=>{const l=this.resolve_,u=this.reject_,g=i.connection;if(i.wasSuccessCode)try{const m=this.callback_(g,g.getResponse());rn(m)?l(m):l()}catch(m){u(m)}else if(g!==null){const m=It();m.serverResponse=g.getErrorText(),this.errorCallback_?u(this.errorCallback_(g,m)):u(m)}else if(i.canceled){const m=this.appDelete_?Ts():As();u(m)}else{const m=ks();u(m)}};this.canceled_?n(!1,new ot(!1,null,!0)):this.backoffId_=tn(t,n,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&sn(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class ot{constructor(t,n,a){this.wasSuccessCode=t,this.connection=n,this.canceled=!!a}}function ln(s,t){t!==null&&t.length>0&&(s.Authorization="Firebase "+t)}function cn(s,t){s["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function dn(s,t){t&&(s["X-Firebase-GMPID"]=t)}function un(s,t){t!==null&&(s["X-Firebase-AppCheck"]=t)}function hn(s,t,n,a,i,l,u=!0,g=!1){const m=Es(s.urlParams),y=s.url+m,_=Object.assign({},s.headers);return dn(_,t),ln(_,n),cn(_,l),un(_,a),new on(y,s.method,_,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,i,u,g)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mn(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function fn(...s){const t=mn();if(t!==void 0){const n=new t;for(let a=0;a<s.length;a++)n.append(s[a]);return n.getBlob()}else{if(Ot())return new Blob(s);throw new D(F.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function pn(s,t,n){return s.webkitSlice?s.webkitSlice(t,n):s.mozSlice?s.mozSlice(t,n):s.slice?s.slice(t,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gn(s){if(typeof atob>"u")throw Qr("base-64");return atob(s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ae={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Rt{constructor(t,n){this.data=t,this.contentType=n||null}}function Ds(s,t){switch(s){case ae.RAW:return new Rt(Is(t));case ae.BASE64:case ae.BASE64URL:return new Rt(Os(s,t));case ae.DATA_URL:return new Rt(bn(t),jn(t))}throw It()}function Is(s){const t=[];for(let n=0;n<s.length;n++){let a=s.charCodeAt(n);if(a<=127)t.push(a);else if(a<=2047)t.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(n<s.length-1&&(s.charCodeAt(n+1)&64512)===56320))t.push(239,191,189);else{const l=a,u=s.charCodeAt(++n);a=65536|(l&1023)<<10|u&1023,t.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?t.push(239,191,189):t.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(t)}function xn(s){let t;try{t=decodeURIComponent(s)}catch{throw Ve(ae.DATA_URL,"Malformed data URL.")}return Is(t)}function Os(s,t){switch(s){case ae.BASE64:{const i=t.indexOf("-")!==-1,l=t.indexOf("_")!==-1;if(i||l)throw Ve(s,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case ae.BASE64URL:{const i=t.indexOf("+")!==-1,l=t.indexOf("/")!==-1;if(i||l)throw Ve(s,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=gn(t)}catch(i){throw i.message.includes("polyfill")?i:Ve(s,"Invalid character found")}const a=new Uint8Array(n.length);for(let i=0;i<n.length;i++)a[i]=n.charCodeAt(i);return a}class Ls{constructor(t){this.base64=!1,this.contentType=null;const n=t.match(/^data:([^,]+)?,/);if(n===null)throw Ve(ae.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=n[1]||null;a!=null&&(this.base64=_n(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=t.substring(t.indexOf(",")+1)}}function bn(s){const t=new Ls(s);return t.base64?Os(ae.BASE64,t.rest):xn(t.rest)}function jn(s){return new Ls(s).contentType}function _n(s,t){return s.length>=t.length?s.substring(s.length-t.length)===t:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pe{constructor(t,n){let a=0,i="";cs(t)?(this.data_=t,a=t.size,i=t.type):t instanceof ArrayBuffer?(n?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),a=this.data_.length):t instanceof Uint8Array&&(n?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),a=t.length),this.size_=a,this.type_=i}size(){return this.size_}type(){return this.type_}slice(t,n){if(cs(this.data_)){const a=this.data_,i=pn(a,t,n);return i===null?null:new pe(i)}else{const a=new Uint8Array(this.data_.buffer,t,n-t);return new pe(a,!0)}}static getBlob(...t){if(Ot()){const n=t.map(a=>a instanceof pe?a.data_:a);return new pe(fn.apply(null,n))}else{const n=t.map(u=>ut(u)?Ds(ae.RAW,u).data:u.data_);let a=0;n.forEach(u=>{a+=u.byteLength});const i=new Uint8Array(a);let l=0;return n.forEach(u=>{for(let g=0;g<u.length;g++)i[l++]=u[g]}),new pe(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lt(s){let t;try{t=JSON.parse(s)}catch{return null}return an(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yn(s){if(s.length===0)return null;const t=s.lastIndexOf("/");return t===-1?"":s.slice(0,t)}function Nn(s,t){const n=t.split("/").filter(a=>a.length>0).join("/");return s.length===0?n:s+"/"+n}function $s(s){const t=s.lastIndexOf("/",s.length-2);return t===-1?s:s.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(s,t){return t}class Z{constructor(t,n,a,i){this.server=t,this.local=n||t,this.writable=!!a,this.xform=i||vn}}let lt=null;function wn(s){return!ut(s)||s.length<2?s:$s(s)}function ht(){if(lt)return lt;const s=[];s.push(new Z("bucket")),s.push(new Z("generation")),s.push(new Z("metageneration")),s.push(new Z("name","fullPath",!0));function t(l,u){return wn(u)}const n=new Z("name");n.xform=t,s.push(n);function a(l,u){return u!==void 0?Number(u):u}const i=new Z("size");return i.xform=a,s.push(i),s.push(new Z("timeCreated")),s.push(new Z("updated")),s.push(new Z("md5Hash",null,!0)),s.push(new Z("cacheControl",null,!0)),s.push(new Z("contentDisposition",null,!0)),s.push(new Z("contentEncoding",null,!0)),s.push(new Z("contentLanguage",null,!0)),s.push(new Z("contentType",null,!0)),s.push(new Z("metadata","customMetadata",!0)),lt=s,lt}function Un(s,t){function n(){const a=s.bucket,i=s.fullPath,l=new K(a,i);return t._makeStorageReference(l)}Object.defineProperty(s,"ref",{get:n})}function Sn(s,t,n){const a={};a.type="file";const i=n.length;for(let l=0;l<i;l++){const u=n[l];a[u.local]=u.xform(a,t[u.server])}return Un(a,s),a}function Ms(s,t,n){const a=Lt(t);return a===null?null:Sn(s,a,n)}function Pn(s,t,n,a){const i=Lt(t);if(i===null||!ut(i.downloadTokens))return null;const l=i.downloadTokens;if(l.length===0)return null;const u=encodeURIComponent;return l.split(",").map(y=>{const _=s.bucket,P=s.fullPath,w="/b/"+u(_)+"/o/"+u(P),A=Ne(w,n,a),T=Es({alt:"media",token:y});return A+T})[0]}function $t(s,t){const n={},a=t.length;for(let i=0;i<a;i++){const l=t[i];l.writable&&(n[l.server]=s[l.local])}return JSON.stringify(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ds="prefixes",us="items";function kn(s,t,n){const a={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[ds])for(const i of n[ds]){const l=i.replace(/\/$/,""),u=s._makeStorageReference(new K(t,l));a.prefixes.push(u)}if(n[us])for(const i of n[us]){const l=s._makeStorageReference(new K(t,i.name));a.items.push(l)}return a}function An(s,t,n){const a=Lt(n);return a===null?null:kn(s,t,a)}class xe{constructor(t,n,a,i){this.url=t,this.method=n,this.handler=a,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function he(s){if(!s)throw It()}function mt(s,t){function n(a,i){const l=Ms(s,i,t);return he(l!==null),l}return n}function Rn(s,t){function n(a,i){const l=An(s,t,i);return he(l!==null),l}return n}function Tn(s,t){function n(a,i){const l=Ms(s,i,t);return he(l!==null),Pn(l,i,s.host,s._protocol)}return n}function $e(s){function t(n,a){let i;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?i=Wr():i=Gr():n.getStatus()===402?i=Hr(s.bucket):n.getStatus()===403?i=Jr(s.path):i=a,i.status=n.getStatus(),i.serverResponse=a.serverResponse,i}return t}function ft(s){const t=$e(s);function n(a,i){let l=t(a,i);return a.getStatus()===404&&(l=zr(s.path)),l.serverResponse=i.serverResponse,l}return n}function Bs(s,t,n){const a=t.fullServerUrl(),i=Ne(a,s.host,s._protocol),l="GET",u=s.maxOperationRetryTime,g=new xe(i,l,mt(s,n),u);return g.errorHandler=ft(t),g}function Cn(s,t,n,a,i){const l={};t.isRoot?l.prefix="":l.prefix=t.path+"/",n.length>0&&(l.delimiter=n),a&&(l.pageToken=a),i&&(l.maxResults=i);const u=t.bucketOnlyServerUrl(),g=Ne(u,s.host,s._protocol),m="GET",y=s.maxOperationRetryTime,_=new xe(g,m,Rn(s,t.bucket),y);return _.urlParams=l,_.errorHandler=$e(t),_}function En(s,t,n){const a=t.fullServerUrl(),i=Ne(a,s.host,s._protocol),l="GET",u=s.maxOperationRetryTime,g=new xe(i,l,Tn(s,n),u);return g.errorHandler=ft(t),g}function Fn(s,t,n,a){const i=t.fullServerUrl(),l=Ne(i,s.host,s._protocol),u="PATCH",g=$t(n,a),m={"Content-Type":"application/json; charset=utf-8"},y=s.maxOperationRetryTime,_=new xe(l,u,mt(s,a),y);return _.headers=m,_.body=g,_.errorHandler=ft(t),_}function Dn(s,t){const n=t.fullServerUrl(),a=Ne(n,s.host,s._protocol),i="DELETE",l=s.maxOperationRetryTime;function u(m,y){}const g=new xe(a,i,u,l);return g.successCodes=[200,204],g.errorHandler=ft(t),g}function In(s,t){return s&&s.contentType||t&&t.type()||"application/octet-stream"}function qs(s,t,n){const a=Object.assign({},n);return a.fullPath=s.path,a.size=t.size(),a.contentType||(a.contentType=In(null,t)),a}function On(s,t,n,a,i){const l=t.bucketOnlyServerUrl(),u={"X-Goog-Upload-Protocol":"multipart"};function g(){let I="";for(let k=0;k<2;k++)I=I+Math.random().toString().slice(2);return I}const m=g();u["Content-Type"]="multipart/related; boundary="+m;const y=qs(t,a,i),_=$t(y,n),P="--"+m+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+_+`\r
--`+m+`\r
Content-Type: `+y.contentType+`\r
\r
`,w=`\r
--`+m+"--",A=pe.getBlob(P,a,w);if(A===null)throw Rs();const T={name:y.fullPath},$=Ne(l,s.host,s._protocol),N="POST",Y=s.maxUploadRetryTime,B=new xe($,N,mt(s,n),Y);return B.urlParams=T,B.headers=u,B.body=A.uploadData(),B.errorHandler=$e(t),B}class dt{constructor(t,n,a,i){this.current=t,this.total=n,this.finalized=!!a,this.metadata=i||null}}function Mt(s,t){let n=null;try{n=s.getResponseHeader("X-Goog-Upload-Status")}catch{he(!1)}return he(!!n&&(t||["active"]).indexOf(n)!==-1),n}function Ln(s,t,n,a,i){const l=t.bucketOnlyServerUrl(),u=qs(t,a,i),g={name:u.fullPath},m=Ne(l,s.host,s._protocol),y="POST",_={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${a.size()}`,"X-Goog-Upload-Header-Content-Type":u.contentType,"Content-Type":"application/json; charset=utf-8"},P=$t(u,n),w=s.maxUploadRetryTime;function A($){Mt($);let N;try{N=$.getResponseHeader("X-Goog-Upload-URL")}catch{he(!1)}return he(ut(N)),N}const T=new xe(m,y,A,w);return T.urlParams=g,T.headers=_,T.body=P,T.errorHandler=$e(t),T}function $n(s,t,n,a){const i={"X-Goog-Upload-Command":"query"};function l(y){const _=Mt(y,["active","final"]);let P=null;try{P=y.getResponseHeader("X-Goog-Upload-Size-Received")}catch{he(!1)}P||he(!1);const w=Number(P);return he(!isNaN(w)),new dt(w,a.size(),_==="final")}const u="POST",g=s.maxUploadRetryTime,m=new xe(n,u,l,g);return m.headers=i,m.errorHandler=$e(t),m}const hs=256*1024;function Mn(s,t,n,a,i,l,u,g){const m=new dt(0,0);if(u?(m.current=u.current,m.total=u.total):(m.current=0,m.total=a.size()),a.size()!==m.total)throw Yr();const y=m.total-m.current;let _=y;i>0&&(_=Math.min(_,i));const P=m.current,w=P+_;let A="";_===0?A="finalize":y===_?A="upload, finalize":A="upload";const T={"X-Goog-Upload-Command":A,"X-Goog-Upload-Offset":`${m.current}`},$=a.slice(P,w);if($===null)throw Rs();function N(k,W){const q=Mt(k,["active","final"]),ie=m.current+_,R=a.size();let z;return q==="final"?z=mt(t,l)(k,W):z=null,new dt(ie,R,q==="final",z)}const Y="POST",B=t.maxUploadRetryTime,I=new xe(n,Y,N,B);return I.headers=T,I.body=$.uploadData(),I.progressCallback=g||null,I.errorHandler=$e(s),I}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bn={STATE_CHANGED:"state_changed"},Q={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Tt(s){switch(s){case"running":case"pausing":case"canceling":return Q.RUNNING;case"paused":return Q.PAUSED;case"success":return Q.SUCCESS;case"canceled":return Q.CANCELED;case"error":return Q.ERROR;default:return Q.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(t,n,a){if(nn(t)||n!=null||a!=null)this.next=t,this.error=n??void 0,this.complete=a??void 0;else{const l=t;this.next=l.next,this.error=l.error,this.complete=l.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oe(s){return(...t)=>{Promise.resolve().then(()=>s(...t))}}class zn{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Pe.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Pe.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Pe.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,n,a,i,l){if(this.sent_)throw Je("cannot .send() more than once");if(Ns(t)&&a&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(n,t,!0),l!==void 0)for(const u in l)l.hasOwnProperty(u)&&this.xhr_.setRequestHeader(u,l[u].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Je("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Je("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Je("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Je("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class Hn extends zn{initXhr(){this.xhr_.responseType="text"}}function ue(){return new Hn}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}constructor(t,n,a=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=t,this._blob=n,this._metadata=a,this._mappings=ht(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{if(this._request=void 0,this._chunkMultiplier=1,i._codeEquals(F.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const l=this.isExponentialBackoffExpired();if(Fs(i.status,[]))if(l)i=ks();else{this.sleepTime=Math.max(this.sleepTime*2,qr),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=i,this._transition("error")}},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals(F.CANCELED)?this.completeTransitions_():(this._error=i,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((i,l)=>{this._resolve=i,this._reject=l,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const t=this._transferred;return n=>this._updateProgress(t+n)}_shouldDoResumable(t){return t.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(t){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([n,a])=>{switch(this._state){case"running":t(n,a);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((t,n)=>{const a=Ln(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(a,ue,t,n);this._request=i,i.getPromise().then(l=>{this._request=void 0,this._uploadUrl=l,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const t=this._uploadUrl;this._resolveToken((n,a)=>{const i=$n(this._ref.storage,this._ref._location,t,this._blob),l=this._ref.storage._makeRequest(i,ue,n,a);this._request=l,l.getPromise().then(u=>{u=u,this._request=void 0,this._updateProgress(u.current),this._needToFetchStatus=!1,u.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const t=hs*this._chunkMultiplier,n=new dt(this._transferred,this._blob.size()),a=this._uploadUrl;this._resolveToken((i,l)=>{let u;try{u=Mn(this._ref._location,this._ref.storage,a,this._blob,t,this._mappings,n,this._makeProgressCallback())}catch(m){this._error=m,this._transition("error");return}const g=this._ref.storage._makeRequest(u,ue,i,l,!1);this._request=g,g.getPromise().then(m=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(m.current),m.finalized?(this._metadata=m.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){hs*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((t,n)=>{const a=Bs(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(a,ue,t,n);this._request=i,i.getPromise().then(l=>{this._request=void 0,this._metadata=l,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((t,n)=>{const a=On(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(a,ue,t,n);this._request=i,i.getPromise().then(l=>{this._request=void 0,this._metadata=l,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(t){const n=this._transferred;this._transferred=t,this._transferred!==n&&this._notifyObservers()}_transition(t){if(this._state!==t)switch(t){case"canceling":case"pausing":this._state=t,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const n=this._state==="paused";this._state=t,n&&(this._notifyObservers(),this._start());break;case"paused":this._state=t,this._notifyObservers();break;case"canceled":this._error=As(),this._state=t,this._notifyObservers();break;case"error":this._state=t,this._notifyObservers();break;case"success":this._state=t,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const t=Tt(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}}on(t,n,a,i){const l=new qn(n||void 0,a||void 0,i||void 0);return this._addObserver(l),()=>{this._removeObserver(l)}}then(t,n){return this._promise.then(t,n)}catch(t){return this.then(null,t)}_addObserver(t){this._observers.push(t),this._notifyObserver(t)}_removeObserver(t){const n=this._observers.indexOf(t);n!==-1&&this._observers.splice(n,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(n=>{this._notifyObserver(n)})}_finishPromise(){if(this._resolve!==void 0){let t=!0;switch(Tt(this._state)){case Q.SUCCESS:Oe(this._resolve.bind(null,this.snapshot))();break;case Q.CANCELED:case Q.ERROR:const n=this._reject;Oe(n.bind(null,this._error))();break;default:t=!1;break}t&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(t){switch(Tt(this._state)){case Q.RUNNING:case Q.PAUSED:t.next&&Oe(t.next.bind(t,this.snapshot))();break;case Q.SUCCESS:t.complete&&Oe(t.complete.bind(t))();break;case Q.CANCELED:case Q.ERROR:t.error&&Oe(t.error.bind(t,this._error))();break;default:t.error&&Oe(t.error.bind(t,this._error))()}}resume(){const t=this._state==="paused"||this._state==="pausing";return t&&this._transition("running"),t}pause(){const t=this._state==="running";return t&&this._transition("pausing"),t}cancel(){const t=this._state==="running"||this._state==="pausing";return t&&this._transition("canceling"),t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ke{constructor(t,n){this._service=t,n instanceof K?this._location=n:this._location=K.makeFromUrl(n,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,n){return new ke(t,n)}get root(){const t=new K(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return $s(this._location.path)}get storage(){return this._service}get parent(){const t=yn(this._location.path);if(t===null)return null;const n=new K(this._location.bucket,t);return new ke(this._service,n)}_throwIfRoot(t){if(this._location.path==="")throw Cs(t)}}function Gn(s,t,n){return s._throwIfRoot("uploadBytesResumable"),new zs(s,new pe(t),n)}function Wn(s){const t={prefixes:[],items:[]};return Hs(s,t).then(()=>t)}async function Hs(s,t,n){const i=await Gs(s,{pageToken:n});t.prefixes.push(...i.prefixes),t.items.push(...i.items),i.nextPageToken!=null&&await Hs(s,t,i.nextPageToken)}function Gs(s,t){t!=null&&typeof t.maxResults=="number"&&Ft("options.maxResults",1,1e3,t.maxResults);const n=t||{},a=Cn(s.storage,s._location,"/",n.pageToken,n.maxResults);return s.storage.makeRequestWithTokens(a,ue)}function Jn(s){s._throwIfRoot("getMetadata");const t=Bs(s.storage,s._location,ht());return s.storage.makeRequestWithTokens(t,ue)}function Vn(s,t){s._throwIfRoot("updateMetadata");const n=Fn(s.storage,s._location,t,ht());return s.storage.makeRequestWithTokens(n,ue)}function Xn(s){s._throwIfRoot("getDownloadURL");const t=En(s.storage,s._location,ht());return s.storage.makeRequestWithTokens(t,ue).then(n=>{if(n===null)throw Zr();return n})}function Kn(s){s._throwIfRoot("deleteObject");const t=Dn(s.storage,s._location);return s.storage.makeRequestWithTokens(t,ue)}function Ws(s,t){const n=Nn(s._location.path,t),a=new K(s._location.bucket,n);return new ke(s.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yn(s){return/^[A-Za-z]+:\/\//.test(s)}function Zn(s,t){return new ke(s,t)}function Js(s,t){if(s instanceof Bt){const n=s;if(n._bucket==null)throw Kr();const a=new ke(n,n._bucket);return t!=null?Js(a,t):a}else return t!==void 0?Ws(s,t):s}function Qn(s,t){if(t&&Yn(t)){if(s instanceof Bt)return Zn(s,t);throw Le("To use ref(service, url), the first argument must be a Storage instance.")}else return Js(s,t)}function ms(s,t){const n=t?.[Ps];return n==null?null:K.makeFromBucketSpec(n,s)}function ea(s,t,n,a={}){s.host=`${t}:${n}`;const i=Ns(t);i&&(fr(`https://${s.host}/b`),pr("Storage",!0)),s._isUsingEmulator=!0,s._protocol=i?"https":"http";const{mockUserToken:l}=a;l&&(s._overrideAuthToken=typeof l=="string"?l:gr(l,s.app.options.projectId))}class Bt{constructor(t,n,a,i,l,u=!1){this.app=t,this._authProvider=n,this._appCheckProvider=a,this._url=i,this._firebaseVersion=l,this._isUsingEmulator=u,this._bucket=null,this._host=Ss,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Mr,this._maxUploadRetryTime=Br,this._requests=new Set,i!=null?this._bucket=K.makeFromBucketSpec(i,this._host):this._bucket=ms(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=K.makeFromBucketSpec(this._url,t):this._bucket=ms(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){Ft("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){Ft("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const n=await t.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(hr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new ke(this,t)}_makeRequest(t,n,a,i,l=!0){if(this._deleted)return new en(Ts());{const u=hn(t,this._appId,a,i,n,this._firebaseVersion,l,this._isUsingEmulator);return this._requests.add(u),u.getPromise().then(()=>this._requests.delete(u),()=>this._requests.delete(u)),u}}async makeRequestWithTokens(t,n){const[a,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,n,a,i).getPromise()}}const fs="@firebase/storage",ps="0.13.14";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ta="storage";function sa(s,t,n){return s=ye(s),Gn(s,t,n)}function ra(s){return s=ye(s),Jn(s)}function na(s,t){return s=ye(s),Vn(s,t)}function aa(s,t){return s=ye(s),Gs(s,t)}function ia(s){return s=ye(s),Wn(s)}function oa(s){return s=ye(s),Xn(s)}function la(s){return s=ye(s),Kn(s)}function gs(s,t){return s=ye(s),Qn(s,t)}function ca(s,t){return Ws(s,t)}function da(s,t,n,a={}){ea(s,t,n,a)}function ua(s,{instanceIdentifier:t}){const n=s.getProvider("app").getImmediate(),a=s.getProvider("auth-internal"),i=s.getProvider("app-check-internal");return new Bt(n,a,i,t,ur)}function ha(){dr(new ys(ta,ua,"PUBLIC").setMultipleInstances(!0)),ts(fs,ps,""),ts(fs,ps,"esm2017")}ha();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(t,n,a){this._delegate=t,this.task=n,this.ref=a}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{constructor(t,n){this._delegate=t,this._ref=n,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new ct(this._delegate.snapshot,this,this._ref)}then(t,n){return this._delegate.then(a=>{if(t)return t(new ct(a,this,this._ref))},n)}on(t,n,a,i){let l;return n&&(typeof n=="function"?l=u=>n(new ct(u,this,this._ref)):l={next:n.next?u=>n.next(new ct(u,this,this._ref)):void 0,complete:n.complete||void 0,error:n.error||void 0}),this._delegate.on(t,l,a||void 0,i||void 0)}}class bs{constructor(t,n){this._delegate=t,this._service=n}get prefixes(){return this._delegate.prefixes.map(t=>new ge(t,this._service))}get items(){return this._delegate.items.map(t=>new ge(t,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ge{constructor(t,n){this._delegate=t,this.storage=n}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(t){const n=ca(this._delegate,t);return new ge(n,this.storage)}get root(){return new ge(this._delegate.root,this.storage)}get parent(){const t=this._delegate.parent;return t==null?null:new ge(t,this.storage)}put(t,n){return this._throwIfRoot("put"),new xs(sa(this._delegate,t,n),this)}putString(t,n=ae.RAW,a){this._throwIfRoot("putString");const i=Ds(n,t),l=Object.assign({},a);return l.contentType==null&&i.contentType!=null&&(l.contentType=i.contentType),new xs(new zs(this._delegate,new pe(i.data,!0),l),this)}listAll(){return ia(this._delegate).then(t=>new bs(t,this.storage))}list(t){return aa(this._delegate,t||void 0).then(n=>new bs(n,this.storage))}getMetadata(){return ra(this._delegate)}updateMetadata(t){return na(this._delegate,t)}getDownloadURL(){return oa(this._delegate)}delete(){return this._throwIfRoot("delete"),la(this._delegate)}_throwIfRoot(t){if(this._delegate._location.path==="")throw Cs(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vs{constructor(t,n){this.app=t,this._delegate=n}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(t){if(js(t))throw Le("ref() expected a child path but got a URL, use refFromURL instead.");return new ge(gs(this._delegate,t),this)}refFromURL(t){if(!js(t))throw Le("refFromURL() expected a full URL but got a child path, use ref() instead.");try{K.makeFromUrl(t,this._delegate.host)}catch{throw Le("refFromUrl() expected a valid full URL but got an invalid one.")}return new ge(gs(this._delegate,t),this)}setMaxUploadRetryTime(t){this._delegate.maxUploadRetryTime=t}setMaxOperationRetryTime(t){this._delegate.maxOperationRetryTime=t}useEmulator(t,n,a={}){da(this._delegate,t,n,a)}}function js(s){return/^[A-Za-z]+:\/\//.test(s)}const ma="@firebase/storage-compat",fa="0.3.24";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pa="storage-compat";function ga(s,{instanceIdentifier:t}){const n=s.getProvider("app-compat").getImmediate(),a=s.getProvider("storage").getImmediate({identifier:t});return new Vs(n,a)}function xa(s){const t={TaskState:Q,TaskEvent:Bn,StringFormat:ae,Storage:Vs,Reference:ge};s.INTERNAL.registerComponent(new ys(pa,ga,"PUBLIC").setServiceProps(t).setMultipleInstances(!0)),s.registerVersion(ma,fa)}xa(Et);const ba=({agent:s,onSubmit:t,onCancel:n,onFieldChange:a,hideOnSubmit:i=!1,onClose:l=()=>{}})=>{const{user:u}=p.useContext(vs),g=p.useRef(null),m=p.useRef(null),y=p.useRef(null),_=p.useRef(null),P=p.useRef(null),w=p.useRef(null),A=p.useRef(null),[T,$]=p.useState(!1);p.useEffect(()=>{const o=()=>{window.pageYOffset>300?$(!0):$(!1)};return window.addEventListener("scroll",o),()=>window.removeEventListener("scroll",o)},[]);const N=o=>{o&&o.current&&o.current.scrollIntoView({behavior:"smooth"})},Y=()=>{window.scrollTo({top:0,behavior:"smooth"})},B=o=>o&&typeof o=="string"&&o.startsWith("blob:"),I=o=>{if(!o||o.trim()==="")return!1;if(o.includes("firebasestorage.googleapis.com"))return!0;try{return new URL(o),!0}catch(d){return o.startsWith("/")?!0:(console.log("Invalid URL format:",d.message),!1)}},k=(o,d="image")=>(console.log(`Processing ${d} preview for URL:`,o),I(o)?o:d==="icon"?"/images/placeholder-icon.png":"/images/placeholder-image.png"),W=(o="icon",d="AI")=>{const j=o==="icon",x=j?100:300,U=j?100:200,S="4a4de7",me="ffffff",fe=j?14:24;return`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='${x}' height='${U}' viewBox='0 0 ${x} ${U}'%3E%3Crect width='${x}' height='${U}' fill='%23${S}'/%3E%3Ctext x='${x/2}' y='${U/2}' font-family='Arial' font-size='${fe}' text-anchor='middle' dominant-baseline='middle' fill='%23${me}'%3E${d}%3C/text%3E%3C/svg%3E`},q={name:"",title:"",description:"",category:"",imageUrl:W("image","Agent Image"),iconUrl:W("icon","AI"),creator:{name:u?.displayName||u?.firstName||"",email:u?.email||"",username:u?.username||u?.displayName?.replace(/\s+/g,"")||u?.email?.split("@")[0]||"",role:u?.role||"Admin",id:u?.uid||""},isFree:!1,paddleCompliant:!1,pricingTier:"free",priceDetails:{basePrice:0,discountedPrice:0,currency:"USD",isFree:!1,isSubscription:!1,discountPercentage:0},features:[""],tags:[""],isFeatured:!1,isVerified:!1,isPopular:!1,isTrending:!1,status:"active",downloadUrl:""},ie={basePrice:0,discountedPrice:0,currency:"USD",isFree:!1,isSubscription:!1,discountPercentage:0},[R,z]=p.useState(()=>{if(!s)return{...ie};const o=s||{},d=o.priceDetails||{};return{basePrice:d.basePrice??0,discountedPrice:d.discountedPrice??d.finalPrice??d.basePrice??0,currency:d.currency||"USD",isFree:o.isFree??!1,isSubscription:o.isSubscription??!1}}),[h,H]=p.useState(()=>{if(console.log("Initial useState for formData, agent:",s),!s)return{...q};let o={...s};if(console.log("Using agent data for initialization:",o),s.data&&typeof s.data=="string")try{const j=JSON.parse(s.data);console.log("Successfully parsed outer data field (init):",j),o={...o,...j}}catch(j){console.error("Error parsing agent.data (init):",j)}else s.data&&typeof s.data=="object"&&(o={...o,...s.data});delete o.data;const d=o.priceDetails||{basePrice:o.basePrice||0,discountedPrice:o.discountedPrice||0,currency:o.currency||"USD",isFree:o.isFree||!1,isSubscription:o.isSubscription||!1,discountPercentage:o.discountPercentage||0};return z(d),Array.isArray(o.features)||(o.features=[]),Array.isArray(o.tags)||(o.tags=[]),(d.basePrice===0||d.discountedPrice===0)&&(d.isFree=!0),z({basePrice:d.basePrice,discountedPrice:d.discountedPrice,currency:d.currency||"USD",isFree:d.isFree,isSubscription:d.isSubscription||!1,discountPercentage:d.discountPercentage||0}),o.priceDetails=d,o.paddleCompliant=o.paddleCompliant??!1,o.pricingTier=o.pricingTier??"free",o.image&&o.image.url&&(o.imageUrl=o.image.url),o.jsonFile&&o.jsonFile.url&&(o.downloadUrl=o.jsonFile.url),["basePrice","discountedPrice","currency","isSubscription","discountPercentage","templateUrl","fileUrl"].forEach(j=>{o[j]!==void 0&&j!=="isFree"&&delete o[j]}),o}),[V,Xe]=p.useState({}),[pt,Ae]=p.useState(""),[Me,Be]=p.useState(""),[C,Ke]=p.useState({}),[ee,Ye]=p.useState(!1),[Re,qt]=p.useState("basic"),[Ze,ve]=p.useState(null),[J,we]=p.useState(null),[Qe,Ue]=p.useState(""),[be,le]=p.useState(null),[et,ce]=p.useState(null),qe=async(o,d,j="image")=>{try{console.log(`Starting ${j} upload for agent: ${d}`);const x=d.toLowerCase().replace(/[^a-z0-9]/g,"_"),U=`agents/${j}s/${x}_${Date.now()}.${o.name.split(".").pop()}`,fe=await Et.storage().ref().child(U).put(o);console.log(`${j} upload completed:`,fe);const nt=await fe.ref.getDownloadURL();return console.log(`${j} download URL:`,nt),nt}catch(x){throw console.error(`Error uploading ${j}:`,x),E.error(`Failed to upload ${j}: ${x.message}`),x}},tt=async(o,d)=>{try{console.log("Starting JSON file upload:",d);const x=`agent_templates/${(d||`agent_${Date.now()}.json`).replace(/[^a-zA-Z0-9_.]/g,"_")}`,me=await Et.storage().ref().child(x).put(o);console.log("JSON file upload completed:",me);const fe=await me.ref.getDownloadURL();return console.log("JSON file download URL:",fe),fe}catch(j){throw console.error("Error uploading JSON file:",j),E.error(`Failed to upload JSON file: ${j.message}`),j}};p.useEffect(()=>{if(!s)return;console.log("Using agent data for initialization:",s);let o={...s};if(o.data){if(console.log("Found nested data property, flattening structure"),typeof o.data=="string")try{const x=JSON.parse(o.data);o={...o,...x}}catch(x){console.error("Error parsing agent.data:",x)}else o={...o,...o.data};delete o.data}const d={basePrice:o.priceDetails?.basePrice??o.basePrice??0,discountedPrice:o.priceDetails?.discountedPrice??o.discountedPrice??0,currency:o.priceDetails?.currency??o.currency??"USD",isFree:o.priceDetails?.isFree??o.isFree??!1,isSubscription:o.priceDetails?.isSubscription??o.isSubscription??!1,discountPercentage:o.priceDetails?.discountPercentage??o.discountPercentage??0};(d.basePrice===0||d.discountedPrice===0)&&(d.isFree=!0),z(d),Array.isArray(o.features)||(o.features=[]),Array.isArray(o.tags)||(o.tags=[]),o.image&&o.image.url&&(o.imageUrl=o.image.url),o.icon&&o.icon.url&&(o.iconUrl=o.icon.url),o.jsonFile&&o.jsonFile.url&&(o.downloadUrl=o.jsonFile.url||o.fileUrl||o.templateUrl||"");const j={...q,...o,priceDetails:d,isFree:d.isFree,isSubscription:d.isSubscription,price:d.discountedPrice};["originalAgentData","basePrice","discountedPrice","currency","discountPercentage","templateUrl","fileUrl"].forEach(x=>{j[x]!==void 0&&x!=="isFree"&&delete j[x]}),H(j),o.imageUrl?Ae(k(o.imageUrl,"image")):o.image&&o.image.url&&Ae(k(o.image.url,"image")),o.iconUrl?Be(k(o.iconUrl,"icon")):o.icon&&o.icon.url&&Be(k(o.icon.url,"icon")),Xe(o)},[s]),p.useEffect(()=>()=>{h.imageUrl&&B(h.imageUrl)&&URL.revokeObjectURL(h.imageUrl),h.iconUrl&&B(h.iconUrl)&&URL.revokeObjectURL(h.iconUrl)},[h.imageUrl,h.iconUrl]),p.useEffect(()=>{console.log("Current form data:",h)},[h]),p.useEffect(()=>{s&&s.id&&!s.priceDetails&&!s.basePrice&&(console.log("No direct price data found, attempting API fetch for price"),zt(s.id))},[s]);const zt=async o=>{try{console.log("Fetching price data for agent:",o);const d=await $r(o);console.log("Retrieved price data:",d),z({basePrice:d?.basePrice??0,discountedPrice:d?.discountedPrice??d?.finalPrice??d?.basePrice??0,currency:d?.currency||"USD",isFree:d?.isFree??d?.basePrice===0??!1,isSubscription:d?.isSubscription??!1}),H(j=>({...j,isFree:d?.isFree??d?.basePrice===0??!1,isSubscription:d?.isSubscription??!1}))}catch(d){if(console.error("Error fetching price data:",d),s&&s.priceDetails){console.log("Using price data from agent object as fallback");const j={basePrice:s.priceDetails?.basePrice??0,discountedPrice:s.priceDetails?.discountedPrice??s.priceDetails?.basePrice??0,currency:s.priceDetails?.currency||"USD",isFree:s?.isFree??s.priceDetails?.basePrice===0??!1,isSubscription:s?.isSubscription??!1};z(j)}else z({basePrice:0,discountedPrice:0,currency:"USD",isFree:!0,isSubscription:!1})}},je=o=>{const{name:d,value:j}=o.target;H(x=>({...x,[d]:j})),a&&a(d,j,V[d])},ne=o=>{const{name:d,checked:j}=o.target;H(x=>({...x,[d]:j})),a&&a(d,j,V[d]),d==="isFree"&&(j?(z(x=>({...x,basePrice:0,discountedPrice:0,isFree:!0})),a&&(a("basePrice",0,V.basePrice),a("discountedPrice",0,V.discountedPrice))):(z(x=>({...x,basePrice:x.basePrice||9.99,discountedPrice:x.discountedPrice||x.basePrice||9.99,isFree:!1})),a&&(a("basePrice",9.99,V.basePrice),a("discountedPrice",9.99,V.discountedPrice))))},Te=(o,d,j)=>{H(x=>({...x,[o]:{...x[o],[d]:j}})),a&&a(`${o}.${d}`,j,V[o]?.[d])},ze=(o,d)=>{const j=d.split(",").map(x=>x.trim()).filter(x=>x);H(x=>({...x,[o]:j}))},Ce=o=>{const{name:d,value:j}=o.target;if(d==="currency"){z(U=>({...U||{},currency:j})),a&&a(d,j,V?.[d]);return}const x=parseFloat(j)||0;d==="basePrice"?(z(U=>{const S=U||{},me=(S.basePrice??0)===(S.discountedPrice??0);return{...S,basePrice:x,discountedPrice:me?x:S.discountedPrice??x,isFree:x===0}}),x===0?(H(U=>({...U,isFree:!0})),a&&a("isFree",!0,V?.isFree)):h.isFree&&(H(U=>({...U,isFree:!1})),a&&a("isFree",!1,V?.isFree))):d==="discountedPrice"&&z(U=>({...U||{},discountedPrice:x})),a&&a(d,x,V?.[d])},Ee=o=>{if(o.target.files&&o.target.files[0]){const d=o.target.files[0];if(d.type!=="application/json"&&!d.name.endsWith(".json")){Ke(j=>({...j,jsonFile:"File must be a valid JSON file"}));return}C.jsonFile&&Ke(j=>{const x={...j};return delete x.jsonFile,x}),we(d),Ue(d.name),a&&a("jsonFile",d,null)}},st=()=>{we(null),Ue(""),a&&a("jsonFile",null,J)},He=async o=>{if(o.preventDefault(),console.log("Form submission starting with agent:",s),console.log("Current form data:",h),console.log("Current price data:",R),!h.name){E.error("Agent name is required");return}Ye(!0);try{const d={...h};"data"in d&&(console.log("Found lingering data property, removing it"),delete d.data),["isSubmitting","errors","originalAgentData","data"].forEach(S=>{d[S]!==void 0&&delete d[S]});const x={basePrice:R.basePrice??0,discountedPrice:R.discountedPrice??0,currency:R.currency??"USD",isFree:R.isFree??d.isFree??!1,isSubscription:R.isSubscription??d.isSubscription??!1,discountPercentage:R.discountPercentage??0};if(d.priceDetails=x,d.price=x.discountedPrice,d.isFree=x.isFree,d.isSubscription=x.isSubscription,d.features=d.features?.filter(S=>S.trim()!=="")||[],d.tags=d.tags?.filter(S=>S.trim()!=="")||[],d.creator={name:d.creator?.name||"Unknown",id:d.creator?.id||u?.uid||"unknown",imageUrl:d.creator?.imageUrl||"",...d.creator},be){console.log("Uploading image file");const S=await qe(be,d.name,"image");d.imageUrl=S}if(et){console.log("Uploading icon file");const S=await qe(et,d.name,"icon");d.iconUrl=S}if(J)if(J instanceof File){console.log("Uploading JSON file");const S=await tt(J,J.name);d.jsonFile={url:S,fileName:J.name,originalName:J.name,contentType:J.type,size:J.size},d.downloadUrl=S}else d.jsonFile=J,d.jsonFileData=void 0,delete d.jsonFileData;const U={...d};["originalAgentData","data","jsonFile"].forEach(S=>{S==="data"?U[S]!==void 0&&(console.log(`Removing ${S} field to prevent duplication`),delete U[S]):typeof U[S]=="object"&&!(U[S]instanceof File)&&S==="jsonFile"&&U.jsonFile?.url&&(U.jsonFileData=JSON.stringify(U.jsonFile))}),"data"in U&&(console.error("Data field still exists after cleanup, removing it"),delete U.data),console.log("Submitting clean data:",U),h.id?(await _r(h.id,U),E.success("Agent updated successfully")):(await ws(U),E.success("Agent created successfully"),i||(h.imageUrl&&B(h.imageUrl)&&URL.revokeObjectURL(h.imageUrl),h.iconUrl&&B(h.iconUrl)&&URL.revokeObjectURL(h.iconUrl),H({...q}),z({...ie}),le(null),ce(null),we(null),Ue(""))),i&&l()}catch(d){console.error("Error submitting agent form:",d),E.error(`Error: ${d.message||"Failed to save agent"}`)}finally{Ye(!1)}},rt=["New","Design","Creative","Productivity","Development","Business","Education","Entertainment","Writing","Self Improvement","Music & Sound Design","Software Development","Drawing & Painting","3D","AI","Airtable","AI Chatbot","AI RAG","AI Research","AI Summarization","Building Blocks","Content Creation","CRM","Crypto Trading","Database & Storage","DevOps","Discord","Document Extraction","Engineering","Finance","Forms & Surveys","Email Automation","Google Workspace","HR","HR & Recruitment","Social Media","Internal Wiki","Invoice Processing","IT Operations","Lead Generation","Lead Nurturing","Marketing","Market Research","Miscellaneous","Multimodal AI","Notion","OpenAI & LLMs","Other","Other Integrations","PDF Processing","Personal Productivity","Product","Project Management","Sales","Security Operations","Slack","Support","Support Chatbot","Telegram","Ticket Management","WhatsApp","WordPress"],Fe=o=>{switch(o){case"USD":return"$";case"EUR":return"€";case"GBP":return"£";default:return"$"}};return p.useEffect(()=>{h.imageUrl&&(console.log("Setting image preview from formData:",h.imageUrl),Ae(k(h.imageUrl,"image"))),h.iconUrl&&(console.log("Setting icon preview from formData:",h.iconUrl),Be(k(h.iconUrl,"icon")))},[h.imageUrl,h.iconUrl]),e.jsxs("form",{className:"agent-form",onSubmit:He,ref:A,children:[e.jsxs("div",{className:"section-navigation",children:[e.jsxs("div",{className:"section-link",onClick:()=>N(g),children:[e.jsx(Ut,{})," Basic Info"]}),e.jsxs("div",{className:"section-link",onClick:()=>N(m),children:[e.jsx(it,{})," Media"]}),e.jsxs("div",{className:"section-link",onClick:()=>N(y),children:[e.jsx(ss,{})," Pricing"]}),e.jsxs("div",{className:"section-link",onClick:()=>N(_),children:[e.jsx(rs,{})," Features"]}),e.jsxs("div",{className:"section-link",onClick:()=>N(w),children:[e.jsx(ns,{})," File Uploads"]}),e.jsxs("div",{className:"section-link",onClick:()=>N(P),children:[e.jsx(as,{})," Status"]})]}),e.jsxs("div",{className:"form-section",ref:g,id:"basic-info",children:[e.jsxs("h3",{className:"form-section-heading",children:[e.jsx(Ut,{})," Basic Information"]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Agent Name*",e.jsx("span",{className:"field-required",children:"Required"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:h.name,onChange:je,className:C.name?"error":""}),C.name&&e.jsx("div",{className:"error-message",children:C.name})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"title",children:["Agent Title*",e.jsx("span",{className:"field-required",children:"Required"})]}),e.jsx("input",{type:"text",id:"title",name:"title",value:h.title,onChange:je,className:C.title?"error":""}),C.title&&e.jsx("div",{className:"error-message",children:C.title})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"description",children:["Description*",e.jsx("span",{className:"field-required",children:"Required"})]}),e.jsx("textarea",{id:"description",name:"description",value:h.description,onChange:je,rows:4,className:C.description?"error":""}),C.description&&e.jsx("div",{className:"error-message",children:C.description})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"category",children:["Category*",e.jsx("span",{className:"field-required",children:"Required"})]}),e.jsxs("select",{id:"category",name:"category",value:h.category,onChange:je,className:C.category?"error":"",children:[e.jsx("option",{value:"",children:"Select a category"}),rt.map(o=>e.jsx("option",{value:o,children:o},o))]}),C.category&&e.jsx("div",{className:"error-message",children:C.category})]}),e.jsxs("div",{className:"form-group creator-info",children:[e.jsx("h4",{children:"Creator Information"}),e.jsxs("div",{className:"creator-fields",children:[e.jsxs("div",{className:"creator-field",children:[e.jsx("label",{children:"Name:"}),e.jsx("input",{type:"text",value:h.creator?.name||"",onChange:o=>Te("creator","name",o.target.value)})]}),e.jsxs("div",{className:"creator-field",children:[e.jsx("label",{children:"Email:"}),e.jsx("input",{type:"email",value:h.creator?.email||"",onChange:o=>Te("creator","email",o.target.value),disabled:!!s})]}),e.jsxs("div",{className:"creator-field",children:[e.jsx("label",{children:"Username:"}),e.jsx("input",{type:"text",value:h.creator?.username||"",onChange:o=>Te("creator","username",o.target.value)})]}),e.jsxs("div",{className:"creator-field",children:[e.jsx("label",{children:"Role:"}),e.jsxs("select",{value:h.creator?.role||"Admin",onChange:o=>Te("creator","role",o.target.value),children:[e.jsx("option",{value:"Admin",children:"Admin"}),e.jsx("option",{value:"Partner",children:"Partner"}),e.jsx("option",{value:"User",children:"User"})]})]})]}),e.jsx("p",{className:"creator-note",children:"These fields will be displayed as the creator of this agent."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"version",children:"Version"}),e.jsx("input",{type:"text",id:"version",name:"version",value:h.version,onChange:je,placeholder:"e.g., 1.0.0"})]})]}),e.jsxs("div",{className:"form-section",ref:m,id:"media",children:[e.jsxs("h3",{className:"form-section-heading",children:[e.jsx(it,{})," Media & Images"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"imageSection",children:"Agent Image"}),e.jsx("div",{className:"media-options",children:e.jsxs("div",{className:"media-option",children:[e.jsx("input",{type:"file",id:"imageUpload",accept:"image/*",onChange:o=>{if(o.target.files&&o.target.files[0])try{const d=URL.createObjectURL(o.target.files[0]);console.log("Image file selected:",o.target.files[0]),le(o.target.files[0]),H({...h,imageUrl:d,_imageFile:o.target.files[0]})}catch(d){console.error("Error creating object URL:",d),le(null),H({...h,imageUrl:W("image",h.name?.charAt(0)||"A"),_imageFile:null})}},className:C.imageUrl?"error":""}),e.jsxs("span",{className:"field-help",children:["Upload Image from Computer (Required)",e.jsx("br",{}),"Supported formats: JPG, PNG, GIF. Max size: 5MB"]}),C.imageUrl&&e.jsx("div",{className:"error-message",children:C.imageUrl})]})})]}),e.jsxs("div",{className:"preview-section",children:[e.jsxs("div",{className:"image-preview",children:[e.jsx("h4",{children:"Image Preview"}),e.jsx("div",{className:"preview-container",children:h.imageUrl&&I(h.imageUrl)?e.jsx("img",{src:h.imageUrl,alt:"Agent image preview",onError:o=>{console.log("Image failed to load:",h.imageUrl),B(h.imageUrl)?(console.log("Detected blob URL that may be invalid, reverting to placeholder"),URL.revokeObjectURL(h.imageUrl),H(d=>({...d,imageUrl:W("image",h.name?.charAt(0)||"A"),_imageFile:null}))):(o.target.src=W("image",h.name?.charAt(0)||"A"),o.target.onerror=null)}}):e.jsxs("div",{className:"no-image",children:[e.jsx(it,{}),e.jsx("span",{children:"Agent Image"})]})})]}),e.jsxs("div",{className:"icon-preview",children:[e.jsx("h4",{children:"Icon Preview"}),e.jsx("div",{className:"preview-container",children:h.iconUrl&&I(h.iconUrl)?e.jsx("img",{src:h.iconUrl,alt:"Agent icon preview",onError:o=>{console.log("Icon failed to load:",h.iconUrl),B(h.iconUrl)?(console.log("Detected blob URL that may be invalid, reverting to placeholder"),URL.revokeObjectURL(h.iconUrl),H(d=>({...d,iconUrl:W("icon",h.name?.charAt(0)||"A"),_iconFile:null}))):(o.target.src=W("icon",h.name?.charAt(0)||"A"),o.target.onerror=null)}}):e.jsxs("div",{className:"no-image",children:[e.jsx(it,{}),e.jsx("span",{children:"AI"})]})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"iconSection",children:"Agent Icon (Optional)"}),e.jsx("div",{className:"media-options",children:e.jsxs("div",{className:"media-option",children:[e.jsx("input",{type:"file",id:"iconUpload",accept:"image/*",onChange:o=>{if(o.target.files&&o.target.files[0])try{const d=URL.createObjectURL(o.target.files[0]);console.log("Icon file selected:",o.target.files[0]),ce(o.target.files[0]),H({...h,iconUrl:d,_iconFile:o.target.files[0]})}catch(d){console.error("Error creating object URL:",d),ce(null),H({...h,iconUrl:W("icon",h.name?.charAt(0)||"A"),_iconFile:null})}}}),e.jsxs("span",{className:"field-help",children:["Upload Icon from Computer",e.jsx("br",{}),"Supported formats: JPG, PNG, GIF. Max size: 5MB"]})]})})]})]}),e.jsxs("div",{className:"form-section",ref:y,id:"pricing",children:[e.jsxs("h3",{className:"form-section-heading",children:[e.jsx(ss,{})," Pricing"]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"isFree",checked:h.isFree,onChange:ne}),e.jsx("span",{children:"Free Agent"})]})}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"isSubscription",checked:h.isSubscription,onChange:ne,disabled:h.isFree}),e.jsx("span",{children:"Subscription-based"})]})}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"paddleCompliant",checked:h.paddleCompliant,onChange:ne}),e.jsx("span",{children:"Paddle Payment Compliant"})]})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pricingTier",children:"Pricing Tier"}),e.jsxs("select",{id:"pricingTier",name:"pricingTier",value:h.pricingTier,onChange:handleInputChange,children:[e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"premium",children:"Premium"}),e.jsx("option",{value:"subscription",children:"Subscription"})]})]}),!h.isFree&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"basePrice",children:["Base Price",e.jsx("span",{className:"field-required",children:"Required"})]}),e.jsxs("div",{className:`price-input ${C.basePrice?"has-error":""}`,children:[e.jsx("span",{className:"currency-symbol",children:Fe(R?.currency||"USD")}),e.jsx("input",{type:"number",id:"basePrice",name:"basePrice",value:R?.basePrice??0,onChange:Ce,step:"0.01",min:"0"})]}),C.basePrice&&e.jsx("div",{className:"error-message",children:C.basePrice})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"discountedPrice",children:"Discounted Price"}),e.jsxs("div",{className:"price-input",children:[e.jsx("span",{className:"currency-symbol",children:Fe(R?.currency||"USD")}),e.jsx("input",{type:"number",id:"discountedPrice",name:"discountedPrice",value:R?.discountedPrice??0,onChange:Ce,step:"0.01",min:"0"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"currency",children:"Currency"}),e.jsxs("select",{id:"currency",name:"currency",value:R.currency||"USD",onChange:Ce,children:[e.jsx("option",{value:"USD",children:"USD ($)"}),e.jsx("option",{value:"EUR",children:"EUR (€)"}),e.jsx("option",{value:"GBP",children:"GBP (£)"})]})]})]})]}),e.jsxs("div",{className:"form-section",ref:_,id:"features",children:[e.jsxs("h3",{className:"form-section-heading",children:[e.jsx(rs,{})," Features & Tags"]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"features",children:["Features",e.jsx("span",{className:"field-help",children:"Comma-separated list of features"})]}),e.jsx("textarea",{id:"features",value:Array.isArray(h.features)?h.features.join(", "):"",onChange:o=>ze("features",o.target.value),placeholder:"Desktop App, Voice Enabled, Web Interface",rows:"3"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"tags",children:["Tags",e.jsx("span",{className:"field-help",children:"Comma-separated list of tags"})]}),e.jsx("textarea",{id:"tags",value:Array.isArray(h.tags)?h.tags.join(", "):"",onChange:o=>ze("tags",o.target.value),placeholder:"Education, Assistant, AI, Creative",rows:"3"})]})]}),e.jsxs("div",{className:"form-section",ref:w,id:"file-uploads",children:[e.jsxs("h3",{className:"form-section-heading",children:[e.jsx(ns,{})," File Uploads"]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"jsonFileUpload",children:["Agent JSON File",e.jsx("span",{className:"field-help",children:"Upload a JSON file with agent configuration or template"})]}),e.jsxs("div",{className:"file-upload-container",children:[e.jsx("input",{type:"file",id:"jsonFileUpload",accept:".json,application/json",onChange:Ee,className:C.jsonFile?"error":"",style:{display:Qe?"none":"block"}}),Qe&&e.jsxs("div",{className:"file-selected",children:[e.jsx(xr,{className:"file-icon"}),e.jsx("span",{className:"file-name",children:Qe}),e.jsx("button",{type:"button",className:"clear-file-btn",onClick:st,children:"✕"})]}),C.jsonFile&&e.jsx("div",{className:"error-message",children:C.jsonFile})]}),e.jsx("p",{className:"file-upload-help",children:"Supported format: JSON files only. This file will be downloadable by users who purchase or access this agent."}),h.downloadUrl&&!J&&e.jsxs("div",{className:"existing-file",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Current file:"})," ",e.jsx("a",{href:h.downloadUrl,target:"_blank",rel:"noopener noreferrer",children:h.downloadUrl.split("/").pop()||"View file"})]}),e.jsx("p",{className:"field-help",children:"Upload a new file to replace the current one, or leave empty to keep it."})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"templateUrl",children:"Template URL (Optional)"}),e.jsx("input",{type:"text",id:"templateUrl",name:"templateUrl",value:h.templateUrl,onChange:je,placeholder:"https://example.com/template.json"}),e.jsx("p",{className:"field-help",children:"External URL to a template file. Use this if you're not uploading a file directly."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"downloadUrl",children:"Download URL (Optional)"}),e.jsx("input",{type:"text",id:"downloadUrl",name:"downloadUrl",value:h.downloadUrl,onChange:je,placeholder:"https://example.com/download.json"}),e.jsx("p",{className:"field-help",children:"External URL for downloads. This will be used if no file is uploaded."})]})]}),e.jsxs("div",{className:"form-section",ref:P,id:"status",children:[e.jsxs("h3",{className:"form-section-heading",children:[e.jsx(as,{})," Status & Visibility"]}),e.jsxs("div",{className:"status-toggles",children:[e.jsxs("div",{className:"form-group checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"isFeatured",checked:h.isFeatured,onChange:ne}),e.jsx("span",{children:"Featured"})]}),e.jsx("p",{className:"field-help",children:"Display in the featured section"})]}),e.jsxs("div",{className:"form-group checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"isBestseller",checked:h.isBestseller,onChange:ne}),e.jsx("span",{children:"Bestseller"})]}),e.jsx("p",{className:"field-help",children:"Mark as a bestselling agent"})]}),e.jsxs("div",{className:"form-group checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"isNew",checked:h.isNew,onChange:ne}),e.jsx("span",{children:"New"})]}),e.jsx("p",{className:"field-help",children:"Mark as newly added"})]}),e.jsxs("div",{className:"form-group checkbox-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"isTrending",checked:h.isTrending,onChange:ne}),e.jsx("span",{children:"Trending"})]}),e.jsx("p",{className:"field-help",children:"Mark as trending"})]})]})]}),e.jsxs("div",{className:"form-actions",children:[s&&s.id&&s.id.toString().startsWith("agent-")&&e.jsxs("div",{className:"mock-agent-notice",children:[e.jsx(Ut,{})," This is a mock agent for development. Some features may be limited."]}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:n,disabled:ee,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:ee,children:ee?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(br,{})," ",s?"Update Agent":"Create Agent"]})})]}),Ze&&e.jsx("div",{className:"form-error-message",children:Ze}),e.jsx("div",{className:`back-to-top ${T?"visible":""}`,onClick:Y,children:e.jsx(jr,{})})]})},ja=async s=>{try{if(!s||typeof s!="string"||s.trim()==="")return console.error("Invalid agent ID:",s),{success:!1,message:"Cannot delete agent: Invalid agent ID"};const t=s.trim();console.log("Agent ID debug info:",{original:s,cleaned:t,length:t.length,format:/^[a-zA-Z0-9-_]+$/.test(t)?"valid":"has-special-chars",hasSlashes:t.includes("/"),hasSpaces:/\s/.test(t)}),console.log(`Attempting to delete agent: ${t}`);const n=Us();console.log("Token available:",!!n,"Prefix:",n?n.substring(0,10):"none","Length:",n?n.length:0);const a=Dt();console.log("Using headers:",a),console.log(`Making DELETE request to: ${Ct}/api/agent/${t}`);const i=await fetch(`${Ct}/api/agent/${t}`,{method:"DELETE",headers:a,credentials:"include"});console.log(`Delete response status: ${i.status}`);try{const g=await i.clone().text();console.log("Full response:",g);try{const m=JSON.parse(g);console.log("Response as JSON:",m)}catch{}}catch(u){console.log("Could not read response body:",u)}if(!i.ok){let u=`Failed to delete agent. Status: ${i.status}`;try{u=(await i.json()).message||u}catch{try{const m=await i.text();m&&(u+=` - ${m}`)}catch{}}throw new Error(u)}let l={message:"Agent deleted successfully"};try{l=await i.json()}catch{}return{success:!0,message:l.message||"Agent deleted successfully",data:l}}catch(t){return console.error("Error deleting agent:",t),{success:!1,message:t.message||"An error occurred while deleting the agent"}}},_s=({title:s,message:t,onConfirm:n,onCancel:a})=>e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:s}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:t}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",children:"Cancel"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600",children:"Confirm"})]})]})}),Ua=()=>{const s=yr(),{user:t,token:n}=p.useContext(vs),{posts:a,fetchAllPosts:i,loading:l,error:u,removePostFromCache:g}=p.useContext(Nr),[m,y]=p.useState("agents"),[_,P]=p.useState([]),[w,A]=p.useState(!0),[T,$]=p.useState(null),[N,Y]=p.useState(null),[B,I]=p.useState(""),[k,W]=p.useState("All"),[q,ie]=p.useState(1),[R,z]=p.useState(1),[h,H]=p.useState("username"),[V,Xe]=p.useState("asc"),[pt,Ae]=p.useState(""),[Me,Be]=p.useState(""),[C,Ke]=p.useState(""),[ee,Ye]=p.useState("name"),[Re,qt]=p.useState("asc"),[Ze,ve]=p.useState(!1),[J,we]=p.useState(null),[Qe,Ue]=p.useState(!1),[be,le]=p.useState(null),[et,ce]=p.useState(!1),[qe,tt]=p.useState({checked:!1,isOnline:!0,message:""}),[zt,je]=p.useState({isAuthenticated:!0,networkError:!1,errorMessage:null,errorCode:null}),[ne,Te]=p.useState([]),[ze,Ce]=p.useState(!1),[Ee,st]=p.useState(null),[He,rt]=p.useState(""),[Fe,o]=p.useState({}),d=300*1e3,j=30*1e3,x=(r,c=!1)=>{if(!r||!r.timestamp)return!1;const f=Date.now(),b=c?j:d;return f-r.timestamp<b},[U,S]=p.useState({}),me=r=>{if(!r)return null;let c=r;return c.startsWith("agent-")&&(c=c.substring(6)),c},fe=async(r,c=!1,f=!1)=>{try{if(!r)return console.error("getAgentWithCache called with null/undefined agentId"),null;const b=typeof r=="string"?r.trim():String(r),v=b.toString().startsWith("agent-"),oe=Fe[b];if(!f&&x(oe,!!be))return oe.data;if(v){const G={id:b,error:"Endpoint not found",message:"This API endpoint is not yet available. Try implementing it on the backend.",name:`Test Agent ${b}`,description:"This is a mock agent for testing",priceDetails:{basePrice:9.99,discountedPrice:7.99,currency:"USD"},isFree:!1,isSubscription:!1};return o(O=>({...O,[b]:{data:G,timestamp:Date.now()}})),G}const M=me(b);if(!M)return console.error("Failed to prepare valid API agent ID"),null;try{const G=await De(`https://api.aiwaverider.com/api/agent/${M}`,"GET",null,c?{}:{includePrice:"true"});if(o(O=>({...O,[b]:{data:G,timestamp:Date.now()}})),c||G.priceDetails)return G;try{const O=await De(`https://api.aiwaverider.com/api/agent/${M}/price`,"GET");if(O){const L={...G,priceDetails:{basePrice:O.basePrice||0,discountedPrice:O.discountedPrice||O.finalPrice||0,currency:O.currency||"USD"},isFree:O.isFree||O.basePrice===0,isSubscription:O.isSubscription||!1};return o(re=>({...re,[b]:{data:L,timestamp:Date.now()}})),L}}catch(O){console.error(`Error fetching price data for agent ${M}:`,O)}return G}catch(G){if(G?.status===404){console.warn(`Agent not found with ID ${M}, using mock data`);const O={id:b,error:"Endpoint not found",message:"This API endpoint is not yet available. Try implementing it on the backend.",name:`Test Agent ${b}`,description:"This is a mock agent for testing",priceDetails:{basePrice:9.99,discountedPrice:7.99,currency:"USD"},isFree:!1,isSubscription:!1};return o(L=>({...L,[b]:{data:O,timestamp:Date.now()}})),O}throw G}}catch(b){throw console.error("Error in getAgentWithCache:",b),b}},nt=r=>{o(c=>{const f={...c};return delete f[r],f})};p.useEffect(()=>{Lr(),Ge()},[]),p.useEffect(()=>{(async()=>{try{const c=await Ar();tt({checked:!0,isOnline:c.isOnline,message:c.message}),c.isOnline||(console.warn("Backend API is not available:",c.message),E.error(`Backend API issue: ${c.message}. Using mock data.`))}catch(c){console.error("Error checking API status:",c),tt({checked:!0,isOnline:!1,message:c.message}),E.error("Could not connect to backend. Using mock data.")}})()},[]);const De=async(r,c,f=null,b={})=>{try{const v=await Dt(),oe={method:c,headers:v,credentials:"include"};f&&c!=="GET"&&(oe.headers["Content-Type"]="application/json",oe.body=JSON.stringify(f));let _e=r;if(Object.keys(b).length>0){const re=new URLSearchParams;Object.entries(b).forEach(([Se,wt])=>{re.append(Se,wt)}),_e=`${r}?${re.toString()}`}const M=await fetch(_e,oe);if(M.status===204)return{success:!0,message:"Operation completed successfully",status:204};const G=M.headers.get("content-type"),O=G&&G.includes("application/json");let L;if(O?L=await M.json():L={status:M.status,text:await M.text(),success:M.ok},!M.ok){console.error(` API Error: ${M.status} - ${JSON.stringify(L)}`);const re=new Error(JSON.stringify(L));throw re.status=M.status,re.statusText=M.statusText,re.response=L,re}return r.includes("/price")&&L?gt(L):r.includes("/agent/")&&!r.includes("/price")&&L?Xs(L):L}catch(v){throw console.error(`API Error in ${c} ${r}:`,v),v.message==="Failed to fetch"?E.error("Network error. Please check your connection and try again."):v.status===401?E.error("Authentication error. Please log in again."):v.status===403&&E.error("Permission denied. You do not have access to this resource."),v}},gt=r=>{if(!r)return null;const c=typeof r.basePrice=="number"?r.basePrice:parseFloat(r.basePrice)||0;let f=c;typeof r.discountedPrice=="number"||r.discountedPrice?f=typeof r.discountedPrice=="number"?r.discountedPrice:parseFloat(r.discountedPrice)||c:(typeof r.finalPrice=="number"||r.finalPrice)&&(f=typeof r.finalPrice=="number"?r.finalPrice:parseFloat(r.finalPrice)||c);const b=c>0?Math.round((c-f)/c*100):0;return{...r,basePrice:c,discountedPrice:f,finalPrice:f,discountPercentage:b,currency:r.currency||"USD",isFree:c===0||!!r.isFree,isSubscription:!!r.isSubscription}},Xs=r=>{if(!r)return null;const c={...r};if(c.priceDetails){const f=gt(c.priceDetails);c.priceDetails=f,c.basePrice=f.basePrice,c.discountedPrice=f.discountedPrice,c.price=f.discountedPrice,c.isFree=f.isFree,c.isSubscription=f.isSubscription,c.discountPercentage=f.discountPercentage}else{const f={basePrice:c.basePrice||0,discountedPrice:c.discountedPrice||c.price||0,currency:c.currency||"USD",isFree:c.isFree||c.basePrice===0||c.price===0,isSubscription:c.isSubscription||!1},b=gt(f);c.priceDetails=b,c.basePrice=b.basePrice,c.discountedPrice=b.discountedPrice,c.price=b.discountedPrice,c.isFree=b.isFree,c.isSubscription=b.isSubscription,c.discountPercentage=b.discountPercentage}return c};p.useEffect(()=>{Ge()},[]);const Ge=async()=>{A(!0),$(null);try{if(qe.checked&&!qe.isOnline){const f=Ht();P(f);return}const r=Date.now(),c=await De("https://api.aiwaverider.com/api/agents","GET",null,{timestamp:r}).catch(f=>(console.warn("Using mock data due to API error:",f.message),{agents:Ht()}));if(c.agents){o({});const f={};c.agents.forEach(v=>{f[v.id]={data:v,timestamp:Date.now()}}),o(f);const b=[...c.agents].sort((v,oe)=>{const _e=parseInt(v.id.replace(/\D/g,""))||0,M=parseInt(oe.id.replace(/\D/g,""))||0;return _e-M});P(b)}else console.warn("⚠️ Response does not contain agents array, using empty array"),P([])}catch(r){console.error("❌ Error fetching agents:",r),$("Failed to fetch agents. "+r.message),P([])}finally{A(!1)}},Ht=()=>Array(10).fill().map((r,c)=>({id:`agent-${c+1}`,name:`Test Agent ${c+1}`,category:c%3===0?"AI":c%3===1?"Machine Learning":"Natural Language",description:`This is a description for test agent ${c+1}`,price:(c+1)*10,imageUrl:`https://picsum.photos/200/200?random=${c}`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})),Ks=r=>{we(r),ve(!0)},Ys=async()=>{if(!J||!J.id){E.error("Cannot delete: Missing agent ID"),Ue(!1),ve(!1);return}Ue(!0);try{const r=await ja(J.id);r.success?(P(_.filter(c=>c.id!==J.id)),E.success("Agent deleted successfully")):(E.error(r.message||"Failed to delete agent"),console.error("❌ Failed to delete agent:",r.message),r.message&&r.message.includes("not a valid resource path")&&(E.error("Database error: The agent ID format is invalid",{duration:6e3}),console.error("Firestore path error detected - agent ID format issue")))}catch(r){console.error("Error deleting agent:",r),E.error(`Error deleting agent: ${r.message}`)}finally{Ue(!1),ve(!1),we(null)}},Zs=r=>{try{if(!r||!r.id){console.error("Cannot edit agent: Missing agent ID"),showToast("Invalid agent data. Cannot edit.","error");return}const c=typeof r.id=="string"?r.id.trim():String(r.id),f=c.toString().startsWith("agent-"),b={...r,id:c},v=Fe[c];if(v&&Date.now()-v.timestamp<3e4){if(le(v.data),ce(!0),f)return;Date.now()-v.timestamp>1e4&&Gt(c)}else le(b),ce(!0),f||Gt(c)}catch(c){console.error("Error in handleEditClick:",c),showToast("An error occurred while preparing to edit the agent.","error")}},Gt=async r=>{try{if(!r){console.error("refreshAgentInBackground: missing agentId parameter");return}if(r.toString().startsWith("agent-")){const b=Fe[r];if(b&&b.data){le(b.data);return}}const f=await fe(r,!0,!0);f?le(f):console.warn("No data returned when refreshing agent in background")}catch(c){console.warn("Error refreshing agent data:",c)}},Qs=async r=>{try{setFormSubmitting(!0),setFormError(null);const c=be?.id,{basePrice:f,discountedPrice:b,currency:v,isFree:oe,isSubscription:_e,discountPercentage:M,...G}=r,O={basePrice:parseFloat(f)||0,discountedPrice:parseFloat(b)||parseFloat(f)||0,currency:v||"USD",isFree:oe===!0||f===0||f==="0",isSubscription:_e===!0,discountPercentage:M||0};let L,re;try{re=(await Tr(()=>import("./index-CDuOHj3I.js").then(wt=>wt.c9),__vite__mapDeps([0,1]))).updateAgentWithPrice}catch(Se){console.error("Error importing updateAgentWithPrice:",Se)}if(c?re?L=await re(c,G,O):L=await De(`/api/agents/${c}`,"PUT",G):L=await ws({...G,priceDetails:O}),L){nt(L.id);try{const Se=await De("/api/agents/refresh-cache","GET")}catch(Se){console.warn("Failed to refresh server cache:",Se)}E.success(c?"Agent updated successfully":"Agent created successfully"),A(!0),await Ge(),A(!1),ce(!1),le(null)}return L}catch(c){return console.error("Error submitting agent form:",c),E.error(`Failed to ${be?"update":"create"} agent: ${c.message}`),null}finally{setFormSubmitting(!1)}},Wt=_.filter(r=>{const c=Me===""||r.name?.toLowerCase().includes(Me.toLowerCase())||r.title?.toLowerCase().includes(Me.toLowerCase()),f=C===""||r.category===C;return c&&f}),Jt=p.useMemo(()=>[...Wt].sort((r,c)=>{let f=0;if(ee==="priceDetails.basePrice"||ee==="basePrice"){const b=r.priceDetails?.basePrice||r.basePrice||0,v=c.priceDetails?.basePrice||c.basePrice||0;f=Re==="asc"?b-v:v-b}else if(ee==="createdAt"||ee==="updatedAt"){const b=new Date(r[ee]||0).getTime(),v=new Date(c[ee]||0).getTime();f=Re==="asc"?b-v:v-b}else{const b=r[ee]?.toString()||"",v=c[ee]?.toString()||"";f=Re==="asc"?b.localeCompare(v):v.localeCompare(b)}if(f===0){const b=parseInt((r.id||"").replace(/\D/g,""))||0,v=parseInt((c.id||"").replace(/\D/g,""))||0;return b-v}return f}),[Wt,ee,Re]);[...new Set(_.map(r=>r.category))];const er=r=>r.isFree?"Free":r.priceDetails?`$${(r.priceDetails.discountedPrice||r.priceDetails.basePrice).toFixed(2)}`:"N/A",tr=r=>`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'%3E%3Crect width='60' height='60' fill='%234a69bd'/%3E%3Ctext x='30' y='35' font-family='Arial' font-size='24' font-weight='bold' text-anchor='middle' fill='white'%3E${(r?.name||"AI").charAt(0).toUpperCase()}%3C/text%3E%3C/svg%3E`,Ie=r=>{if(!r||typeof r!="string"||r.includes("example.com"))return!1;try{return new URL(r),!0}catch{return!1}},xt=r=>{if(r.imageUrl&&Ie(r.imageUrl))return r.imageUrl;if(r.image&&r.image.url&&Ie(r.image.url))return r.image.url;if(r.data&&typeof r.data=="string")try{const c=JSON.parse(r.data);if(c.imageUrl&&Ie(c.imageUrl))return c.imageUrl}catch(c){console.error("Error parsing agent.data for image:",c)}return null},sr=r=>{if(r.iconUrl&&Ie(r.iconUrl))return r.iconUrl;if(r.icon&&r.icon.url&&Ie(r.icon.url))return r.icon.url;if(r.data&&typeof r.data=="string")try{const f=JSON.parse(r.data);if(f.iconUrl&&Ie(f.iconUrl))return f.iconUrl}catch(f){console.error("Error parsing agent.data for icon:",f)}const c=xt(r);return c||null};p.useEffect(()=>{let r=!0;return(async()=>{try{m==="posts"?await i("All",10):m==="agents"&&_.length===0&&!w?Ge():m==="users"&&await de()}catch(f){r&&$(f.message)}})(),()=>{r=!1}},[m,i,_.length,w,q,h,V]);const rr=r=>{if(!r)return[];const c=new Set;return r.filter(f=>{const b=c.has(f.id);return c.add(f.id),!b})},Vt=(()=>{if(!a)return[];const r=a.filter(c=>{if(k!=="All"&&c.category!==k)return!1;const f=B.toLowerCase(),b=c.title?.toLowerCase().includes(f),v=c.id?.toLowerCase().includes(f);return b||v});return rr(r)})(),nr=()=>{s("/posts/create")},ar=r=>{Y(r),ve(!0)},ir=async()=>{if(N)try{const r=await Rr(N.id,n);r.success?(g(N.id),ve(!1),Y(null),Ae("Post deleted successfully!"),setTimeout(()=>Ae(""),3e3)):alert(r.error||"Failed to delete post.")}catch(r){console.error("Error deleting post:",r),alert("An unexpected error occurred while deleting the post.")}},bt=r=>r?new Date(r).toLocaleString():"N/A";m==="users"&&(St,Pt,kt,ze||Ee||(e.Fragment,ne.length>0&&ne.map(r=>e.jsxs("tr",{className:`user-row ${r.status==="inactive"?"inactive":""}`,children:[e.jsxs("td",{className:"user-name-cell",children:[r.photoURL?e.jsx("img",{src:is(r.photoURL),alt:r.firstName,className:"user-avatar"}):e.jsx("div",{className:"avatar-placeholder",children:r.firstName?.charAt(0)||r.username?.charAt(0)||"?"}),e.jsx("span",{children:r.displayName||r.firstName||r.username})]}),e.jsx("td",{children:r.email}),e.jsx("td",{children:e.jsx("span",{className:`role-badge ${r.role}`,children:r.role||"user"})}),e.jsx("td",{children:e.jsx("span",{className:`status-indicator ${r.status||"active"}`,children:r.status||"active"})}),e.jsx("td",{children:r.createdAt?new Date(r.createdAt).toLocaleDateString():"Unknown"}),e.jsxs("td",{className:"actions-cell",children:[e.jsx("button",{className:"action-btn edit-btn",onClick:()=>Kt(r),title:"Edit user",children:"Edit"}),r.role!=="admin"&&e.jsx("button",{className:"action-btn delete-btn",onClick:()=>Zt(r),title:"Delete user",children:"Delete"})]})]},r.id)),R>1),Xt&&(X.username,X.email,X.firstName,X.lastName,!te&&X.password,X.role,X.status,userFormSubmitting,userFormSubmitting),showDeleteUserConfirm&&(te?.username||te?.email,deleteUserLoading,deleteUserLoading));const de=async()=>{if(n){Ce(!0),st(null);try{const r=await de(q,10,He,h,V);Te(r.users||[]),z(r.totalPages||1)}catch(r){console.error("Error fetching users:",r),st(r.message)}finally{Ce(!1)}}},[te,jt]=p.useState(null),[Xt,We]=p.useState(!1),[X,at]=p.useState({username:"",email:"",firstName:"",lastName:"",role:"user",status:"active"}),[_t,yt]=p.useState(null),[or,Nt]=p.useState(!1),Kt=r=>{jt(r),at({username:r.username||"",email:r.email||"",firstName:r.firstName||"",lastName:r.lastName||"",role:r.role||"user",status:r.status||"active"}),We(!0)},se=r=>{const{name:c,value:f}=r.target;at(b=>({...b,[c]:f}))},Yt=async r=>{r.preventDefault();try{te?(await Er(te.id,X),E.success("User updated successfully")):(await Fr(X),E.success("User created successfully")),We(!1),jt(null),at({username:"",email:"",firstName:"",lastName:"",role:"user",status:"active"}),de()}catch(c){console.error("Error submitting user form:",c),E.error(c.message)}},Zt=r=>{yt(r),Nt(!0)},vt=async()=>{if(_t)try{await Dr(_t.id),E.success("User deleted successfully"),Nt(!1),yt(null),de()}catch(r){console.error("Error deleting user:",r),E.error(r.message)}},Qt=()=>{jt(null),at({username:"",email:"",firstName:"",lastName:"",role:"user",status:"active"}),We(!0)},es=async()=>{try{E.info("Refreshing server cache...");const r=await De("/api/agents/refresh-cache","GET");E.success(`Server cache cleared: ${r.message||"Success"}`),A(!0),await Ge(),A(!1)}catch(r){console.error("Failed to clear server cache:",r),E.error(`Failed to clear cache: ${r.message}`)}},lr=()=>e.jsxs("button",{className:"btn btn-info",onClick:es,disabled:w,title:"Refresh server cache and reload agents",children:[e.jsx(os,{className:w?"icon-spin":""})," Refresh Cache"]});return e.jsx(Cr,{children:e.jsxs("div",{className:"manage-agents-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Admin Dashboard"}),pt&&e.jsx("p",{className:"success-message text-green-600 text-center font-semibold mb-4",children:pt}),T&&e.jsx("p",{className:"error-message text-red-500 text-center",children:T}),e.jsxs("div",{className:"tabs-container flex justify-center gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>y("agents"),className:`tab-button px-4 py-2 rounded-md flex items-center ${m==="agents"?"bg-blue-600 text-white":"bg-gray-300 text-gray-700"}`,children:[e.jsx(vr,{className:"mr-2"}),"Agents"]}),e.jsxs("button",{onClick:()=>y("posts"),className:`tab-button px-4 py-2 rounded-md flex items-center ${m==="posts"?"bg-blue-600 text-white":"bg-gray-300 text-gray-700"}`,children:[e.jsx(wr,{className:"mr-2"}),"Posts"]}),e.jsxs("button",{onClick:()=>y("users"),className:`tab-button px-4 py-2 rounded-md flex items-center ${m==="users"?"bg-blue-600 text-white":"bg-gray-300 text-gray-700"}`,children:[e.jsx(Ur,{className:"mr-2"}),"Users"]})]})]}),m==="posts"&&e.jsxs("div",{className:"posts-management",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 mb-6",children:[e.jsx("button",{onClick:nr,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Create New Post"}),e.jsx("input",{type:"text",placeholder:"Search by title or ID...",value:B,onChange:r=>I(r.target.value),className:"flex-1 p-2 border border-gray-300 rounded-md"}),e.jsxs("select",{value:k,onChange:r=>W(r.target.value),className:"p-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"All",children:"All"}),Ir.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),l&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"Loading posts..."})}),u&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-red-500",children:u})}),!l&&!u&&Vt.length===0?e.jsx("p",{className:"text-gray-600 text-center",children:"No posts match your filter/search."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Vt.map((r,c)=>e.jsxs("div",{className:"p-4 border border-gray-200 rounded-md shadow-sm hover:shadow-md flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-blue-700 mb-1 line-clamp-1",children:r.title}),e.jsx("p",{className:"text-sm text-gray-500 mb-2 line-clamp-2",children:r.description}),r.imageUrl&&e.jsx("img",{src:r.imageUrl,alt:r.title,className:"mt-2 h-32 w-full object-cover rounded-md"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Category: ",r.category||"Uncategorized"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Created By: ",r.createdByUsername||"Unknown"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Created At: ",bt(r.createdAt)]})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("button",{onClick:()=>s(`/posts/${r.id}`),className:"px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Edit"}),e.jsx("button",{onClick:()=>ar(r),className:"px-3 py-1 bg-red-500 text-white rounded-md hover:bg-red-600",children:"Delete"})]})]},`${r.id}-${c}`))})]}),m==="users"&&e.jsxs("div",{className:"users-management-section",children:[e.jsx("h2",{className:"section-title",children:"Users Management"}),e.jsxs("div",{className:"users-controls",children:[e.jsxs("div",{className:"users-search",children:[e.jsx("input",{type:"text",placeholder:"Search users...",value:He,onChange:r=>rt(r.target.value),onKeyDown:r=>r.key==="Enter"&&de()}),e.jsx("button",{className:"search-button",onClick:de,children:e.jsx(St,{})})]}),e.jsxs("div",{className:"sort-controls",children:[e.jsxs("select",{value:h,onChange:r=>H(r.target.value),className:"sort-select",children:[e.jsx("option",{value:"username",children:"Username"}),e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"role",children:"Role"}),e.jsx("option",{value:"status",children:"Status"}),e.jsx("option",{value:"createdAt",children:"Join Date"})]}),e.jsx("button",{className:`sort-direction ${V==="desc"?"desc":"asc"}`,onClick:()=>Xe(r=>r==="asc"?"desc":"asc"),children:e.jsx(Pt,{})})]}),e.jsxs("button",{className:"create-user-btn primary-btn",onClick:Qt,children:[e.jsx(kt,{})," Create User"]})]}),e.jsx("div",{className:"users-table-container",children:ze?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading users..."})]}):Ee?e.jsxs("div",{className:"error-display",children:[e.jsxs("p",{className:"error-message",children:["Error loading users: ",Ee]}),e.jsx("button",{onClick:de,className:"retry-btn",children:"Retry"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Joined"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:ne.length>0?ne.map(r=>e.jsxs("tr",{className:`user-row ${r.status==="inactive"?"inactive":""}`,children:[e.jsxs("td",{className:"user-name-cell",children:[r.photoURL?e.jsx("img",{src:is(r.photoURL),alt:r.firstName,className:"user-avatar"}):e.jsx("div",{className:"avatar-placeholder",children:r.firstName?.charAt(0)||r.username?.charAt(0)||"?"}),e.jsx("span",{children:r.displayName||r.firstName||r.username})]}),e.jsx("td",{children:r.email}),e.jsx("td",{children:e.jsx("span",{className:`role-badge ${r.role}`,children:r.role||"user"})}),e.jsx("td",{children:e.jsx("span",{className:`status-indicator ${r.status||"active"}`,children:r.status||"active"})}),e.jsx("td",{children:r.createdAt?new Date(r.createdAt).toLocaleDateString():"Unknown"}),e.jsxs("td",{className:"actions-cell",children:[e.jsx("button",{className:"action-btn edit-btn",onClick:()=>Kt(r),title:"Edit user",children:"Edit"}),r.role!=="admin"&&e.jsx("button",{className:"action-btn delete-btn",onClick:()=>Zt(r),title:"Delete user",children:"Delete"})]})]},r.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"no-data",children:"No users found. Try adjusting your search or create a new user."})})})]}),R>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"pagination-btn",onClick:()=>ie(r=>Math.max(1,r-1)),disabled:q===1,children:"Previous"}),e.jsxs("span",{className:"page-info",children:["Page ",q," of ",R]}),e.jsx("button",{className:"pagination-btn",onClick:()=>ie(r=>Math.min(R,r+1)),disabled:q===R,children:"Next"})]})]})}),Xt&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content user-form-modal",children:[e.jsx("h2",{children:te?"Edit User":"Create New User"}),e.jsxs("form",{onSubmit:Yt,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"username",children:"Username"}),e.jsx("input",{type:"text",id:"username",name:"username",value:X.username||"",onChange:se,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:X.email||"",onChange:se,required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"firstName",children:"First Name"}),e.jsx("input",{type:"text",id:"firstName",name:"firstName",value:X.firstName||"",onChange:se})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lastName",children:"Last Name"}),e.jsx("input",{type:"text",id:"lastName",name:"lastName",value:X.lastName||"",onChange:se})]})]}),!te&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",id:"password",name:"password",value:X.password||"",onChange:se,required:!te})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"role",children:"Role"}),e.jsxs("select",{id:"role",name:"role",value:X.role||"user",onChange:se,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"moderator",children:"Moderator"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:X.status||"active",onChange:se,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"suspended",children:"Suspended"})]})]})]}),e.jsxs("div",{className:"form-buttons",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>We(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:userFormSubmitting,children:userFormSubmitting?"Saving...":te?"Update User":"Create User"})]})]})]})}),showDeleteUserConfirm&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content delete-confirm-modal",children:[e.jsx("h2",{children:"Delete User"}),e.jsxs("p",{children:['Are you sure you want to delete the user "',te?.username||te?.email,'"?']}),e.jsx("p",{className:"warning-text",children:"This action cannot be undone."}),e.jsxs("div",{className:"form-buttons",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>setShowDeleteUserConfirm(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"delete-btn",onClick:vt,disabled:deleteUserLoading,children:deleteUserLoading?"Deleting...":"Delete User"})]})]})})]}),m==="agents"&&e.jsxs("div",{children:[e.jsxs("div",{className:"controls",children:[e.jsxs("button",{className:"btn btn-primary create-button",onClick:()=>{le(null),ce(!0)},style:{marginTop:"20px"},children:[e.jsx(kt,{})," Create New Agent"]}),e.jsxs("button",{className:"btn btn-secondary refresh-button",onClick:es,disabled:w,style:{marginTop:"20px",marginLeft:"10px"},children:[e.jsx(os,{className:w?"icon-spin":""})," Refresh Cache"]}),e.jsxs("div",{className:"filters",children:[e.jsxs("div",{className:"search-filter",children:[e.jsx("label",{htmlFor:"search",children:"Search:"}),e.jsxs("div",{className:"search-input-container",children:[e.jsx(St,{className:"search-icon"}),e.jsx("input",{id:"search",type:"text",className:"search-input",placeholder:"Search agents...",value:Me,onChange:r=>Be(r.target.value)})]})]}),e.jsxs("div",{className:"category-filter",children:[e.jsx("label",{htmlFor:"category",children:"Category:"}),e.jsxs("div",{className:"select-container",children:[e.jsx(Sr,{className:"filter-icon"}),e.jsxs("select",{id:"category",value:C,onChange:r=>Ke(r.target.value),children:[e.jsx("option",{value:"",children:"All Categories"}),e.jsx("option",{value:"Productivity",children:"Productivity"}),e.jsx("option",{value:"Creative",children:"Creative"}),e.jsx("option",{value:"Educational",children:"Educational"}),e.jsx("option",{value:"Entertainment",children:"Entertainment"}),e.jsx("option",{value:"Business",children:"Business"})]})]})]}),e.jsxs("div",{className:"sort-filter",children:[e.jsx("label",{htmlFor:"sort",children:"Sort By:"}),e.jsxs("div",{className:"select-container",style:{paddingBottom:"22px"},children:[e.jsx(Pt,{className:"sort-icon"}),e.jsxs("select",{id:"sort",value:`${ee}-${Re}`,onChange:r=>{const[c,f]=r.target.value.split("-");Ye(c),qt(f)},children:[e.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),e.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),e.jsx("option",{value:"createdAt-desc",children:"Newest First"}),e.jsx("option",{value:"createdAt-asc",children:"Oldest First"}),e.jsx("option",{value:"popularity-desc",children:"Most Popular"}),e.jsx("option",{value:"rating-desc",children:"Highest Rated"})]})]})]})]})]}),w&&e.jsx("div",{className:"loading-container",children:e.jsx("p",{children:"Loading agents..."})}),T&&!w&&e.jsx("div",{className:"error-container",children:e.jsx("p",{className:"error-message",children:T})}),!w&&!T&&e.jsx("div",{className:"manage-agents-list",children:Jt.length===0?e.jsx("p",{className:"manage-no-agents-message",children:"No agents found."}):e.jsx("div",{className:"manage-agents-grid",children:Jt.map(r=>e.jsxs("div",{className:"manage-agent-card",children:[e.jsxs("div",{className:"manage-agent-header",children:[e.jsx("div",{className:"manage-agent-image",children:(()=>{const c=xt(r);return c?e.jsx("img",{src:c,alt:r.name,onError:f=>{f.target.onerror=null,f.target.src=tr(r)}}):e.jsx("div",{className:"manage-agent-icon-placeholder",children:r.name?r.name.charAt(0).toUpperCase():"A"})})()}),e.jsxs("div",{className:"manage-agent-title-section",children:[e.jsx("h3",{className:"manage-agent-name",children:r.name||"Assistant Pro"}),(()=>{const c=sr(r);return c&&c!==xt(r)?e.jsx("img",{src:c,alt:"Icon",className:"manage-agent-small-icon",onError:f=>{f.target.onerror=null,f.target.style.display="none"}}):null})()]})]}),e.jsxs("div",{className:"manage-agent-details",children:[e.jsx("div",{className:"manage-agent-description",style:{whiteSpace:"pre-line"},children:r.description||"An innovative AI tool for enthusiasts, combining cutting-edge technology with intuitive design."}),e.jsxs("div",{className:"manage-agent-info-grid",children:[e.jsxs("div",{className:"manage-agent-info-item",children:[e.jsx("span",{className:"manage-info-label",children:"Category:"}),e.jsx("span",{className:"manage-info-value",children:r.category||"All"})]}),e.jsxs("div",{className:"manage-agent-info-item",children:[e.jsx("span",{className:"manage-info-label",children:"Price:"}),e.jsx("span",{className:"manage-info-value price",children:er(r)})]}),r.features&&Array.isArray(r.features)&&r.features.length>0&&e.jsxs("div",{className:"manage-agent-info-item features",children:[e.jsx("span",{className:"manage-info-label",children:"Features:"}),e.jsxs("ul",{className:"manage-features-list",children:[Array.isArray(r.features)&&r.features.slice(0,3).map((c,f)=>e.jsx("li",{children:c},`${r.id}-feature-${f}`)),Array.isArray(r.features)&&r.features.length>3&&e.jsxs("li",{children:["+",r.features.length-3," more..."]},`${r.id}-more-features`)]})]}),e.jsxs("div",{className:"manage-agent-info-item",children:[e.jsx("span",{className:"manage-info-label",children:"Created:"}),e.jsx("span",{className:"manage-info-value",children:bt(r.createdAt)})]}),r.updatedAt&&e.jsxs("div",{className:"manage-agent-info-item",children:[e.jsx("span",{className:"manage-info-label",children:"Updated:"}),e.jsx("span",{className:"manage-info-value",children:bt(r.updatedAt)})]}),e.jsxs("div",{className:"manage-agent-info-item",children:[e.jsx("span",{className:"manage-info-label",children:"ID:"}),e.jsx("span",{className:"manage-info-value id",children:r.id})]})]})]}),e.jsxs("div",{className:"manage-agent-actions",children:[e.jsxs("button",{className:"btn btn-edit",onClick:()=>Zs(r),children:[e.jsx(Pr,{})," Edit"]}),e.jsxs("button",{className:"btn btn-delete",onClick:()=>Ks(r),children:[e.jsx(kr,{})," Delete"]})]})]},r.id))})})]}),Ze&&e.jsx(_s,{title:"Confirm Deletion",message:N?`Are you sure you want to delete the post titled "${N.title}"? This action cannot be undone.`:`Are you sure you want to delete the agent "${J?.name}"? This action cannot be undone.`,onConfirm:N?ir:Ys,onCancel:()=>{ve(!1),Y(null),we(null)}}),et&&e.jsx(Or,{title:be?"Edit Agent":"Create New Agent",onClose:()=>ce(!1),size:"large",children:e.jsx(ba,{agent:be,onSubmit:Qs,onCancel:()=>ce(!1)})}),or&&e.jsx(_s,{title:"Delete User",message:`Are you sure you want to delete the user "${_t?.username||"Unknown"}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",onConfirm:vt,onCancel:()=>{Nt(!1),yt(null)}}),e.jsx(lr,{})]})})};export{Ua as default};
