import{aE as T,u as D,D as E,aF as F,ad as L,t as U,r as i,j as e,L as m,af as x,I as A,H as q,aG as O,y as n}from"./index-CDuOHj3I.js";const R="https://api.aiwaverider.com",j=T.create({baseURL:R,headers:{"Content-Type":"application/json"}}),M=async s=>{try{const r={amount:s.cartTotal||s.amount,currency:s.currency||"USD",items:s.items||[],customerInfo:{email:s.email||"",userId:s.userId||null},metadata:{orderId:s.orderId||`order_${Date.now()}`,source:"paypal_checkout",...s.metadata}},t=await j.post("/api/payments/paypal/create-order",r);if(!t.data||!t.data.success)throw new Error(t.data?.error||"Failed to create PayPal order");return{id:t.data.id,orderId:t.data.orderId}}catch(r){throw console.error("Error creating PayPal order:",r),r}},Y=async(s,r={})=>{try{const t=await j.post("/api/payments/paypal/capture",{orderID:s,metadata:r});if(!t.data||!t.data.success)throw new Error(t.data?.error||"Failed to capture PayPal payment");return t.data}catch(t){throw console.error("Error capturing PayPal payment:",t),t}},J=()=>{const{cart:s,cartTotal:r,removeFromCart:t,updateQuantity:p,clearCart:g}=D(),P=E(),[{isPending:v}]=F(),{user:l}=L(),o=!!l,{darkMode:f}=U(),N=f?"theme-dark":"theme-light",[d,y]=i.useState(""),[k,u]=i.useState(!1),[b,w]=i.useState(!0);i.useEffect(()=>{const a=setTimeout(()=>w(!1),600);return()=>clearTimeout(a)},[]),i.useEffect(()=>{o&&l?.email&&y(l.email)},[o,l]);const h=r,S="USD";if(s.length===0)return e.jsxs("div",{className:"checkout-container",children:[e.jsxs("div",{className:"checkout-header",children:[e.jsxs(m,{to:"/",className:"back-link",children:[e.jsx(x,{})," Continue Shopping"]}),e.jsx("h1",{children:"Checkout"})]}),e.jsxs("div",{className:"empty-cart",children:[e.jsx("div",{className:"empty-cart-icon",children:e.jsx(A,{})}),e.jsx("h2",{children:"Your cart is empty"}),e.jsx("p",{children:"Looks like you haven't added any products to your cart yet."}),e.jsx(m,{to:"/agents",className:"continue-shopping-btn",children:"Browse Products"})]})]});if(b)return e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen bg-gradient-to-b from-gray-900 to-blue-900",children:[e.jsx("div",{className:"mb-8",children:e.jsx(q,{color:"#4FD1C5",size:70,speedMultiplier:.8})}),e.jsx("div",{className:"text-white text-xl font-semibold mt-4",children:"Loading Checkout"}),e.jsx("div",{className:"text-blue-300 text-sm mt-2",children:"Preparing your shopping cart..."})]});const C=async()=>{try{const a={cartTotal:h,items:s,currency:S,email:d||void 0},{id:c}=await M(a);return c}catch(a){throw n.error("Could not initiate PayPal checkout. Please try again."),u(!1),a}},I=async a=>{try{const c=await Y(a.orderID,{items:JSON.stringify(s),email:d||""});try{c?.templates&&Array.isArray(c.templates)&&c.templates.length>0&&sessionStorage.setItem("downloadTemplates",JSON.stringify(c.templates))}catch{}try{localStorage.setItem("lastPurchasedItems",JSON.stringify(s))}catch{}g(),n.success("Payment successful! Thank you for your purchase."),P(`/checkout/success?payment_id=${a.orderID}&status=success&type=paypal`)}catch{n.error("There was a problem with your payment. Please try again.")}finally{u(!1)}};return e.jsxs("div",{className:`checkout-container ${N}`,children:[e.jsxs("div",{className:"checkout-header",children:[e.jsxs(m,{to:"/",className:"back-link",children:[e.jsx(x,{})," Continue Shopping"]}),e.jsx("h1",{children:"Secure Checkout"})]}),e.jsxs("div",{className:"checkout-content",children:[e.jsxs("div",{className:"checkout-items",children:[e.jsxs("h2",{children:["Your Cart (",s.length," ",s.length===1?"item":"items",")"]}),s.map(a=>e.jsxs("div",{className:"cart-item",children:[e.jsx("div",{className:"item-image",children:e.jsx("img",{src:a.imageUrl,alt:a.title})}),e.jsxs("div",{className:"item-details",children:[e.jsx("h3",{children:a.title}),e.jsxs("p",{className:"item-price",children:["USD ",(a.price||0).toFixed(2)]}),e.jsxs("div",{className:"item-actions",children:[e.jsxs("div",{className:"quantity-controls",children:[e.jsx("button",{onClick:()=>p(a.id,Math.max(1,a.quantity-1)),disabled:a.quantity<=1,children:"-"}),e.jsx("span",{children:a.quantity}),e.jsx("button",{onClick:()=>p(a.id,a.quantity+1),children:"+"})]}),e.jsx("button",{className:"remove-button",onClick:()=>t(a.id),children:"Remove"})]})]}),e.jsxs("div",{className:"item-total",children:["USD ",((a.price||0)*a.quantity).toFixed(2)]})]},a.id))]}),e.jsxs("div",{className:"checkout-summary",children:[e.jsx("h2",{children:"Complete Your Order"}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["USD ",(r||0).toFixed(2)]})]}),e.jsxs("div",{className:"summary-row total",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["USD ",(h||0).toFixed(2)]})]}),!o&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email for delivery receipt"}),e.jsx("input",{type:"email",id:"email",value:d,onChange:a=>y(a.target.value),placeholder:"you@example.com",required:!0})]}),e.jsxs("div",{className:"paypal-focus",children:[e.jsxs("div",{className:"trust-badges",children:[e.jsx("span",{children:"Money-back guarantee"}),e.jsx("span",{children:"Instant delivery to your email"}),e.jsx("span",{children:"Trusted by creators"})]}),v?e.jsx("div",{className:"paypal-loading",children:"Loading PayPal buttons..."}):e.jsx(O,{style:{layout:"vertical",color:"gold",shape:"rect",label:"pay",height:45},disabled:k||!o&&!d,createOrder:C,onApprove:I,onError:a=>{n.error("PayPal error. Please try again."),u(!1)},onCancel:()=>{n.info("Payment cancelled."),u(!1)},forceReRender:[h]}),e.jsx("div",{className:"payment-benefits",children:e.jsxs("ul",{children:[e.jsx("li",{children:"Pay with PayPal balance, card, or bank â€” all via PayPal"}),e.jsx("li",{children:"No account? Check out as guest with your card through PayPal"}),e.jsx("li",{children:"Secure checkout with dispute protection"})]})})]}),e.jsx("p",{className:"security-note",children:e.jsx("small",{children:"Your payment is processed by PayPal. We never store your card details."})})]})]})]})};export{J as default};
