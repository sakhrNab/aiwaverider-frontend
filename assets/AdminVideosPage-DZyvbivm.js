import{t as E,r,A as B,j as e,y as i}from"./index-CDuOHj3I.js";import{V as u}from"./videosService-BnAcYhNJ.js";const R=()=>{const{darkMode:N}=E(),{user:d}=r.useContext(B),[m,y]=r.useState({youtube:[],tiktok:[],instagram:[]}),[k,f]=r.useState(!0),[o,V]=r.useState("youtube"),[A,n]=r.useState(!1),[c,b]=r.useState({platform:"youtube",originalUrl:"",addedBy:d?.displayName||d?.email||"Admin"}),[v,g]=r.useState(!1),h=async()=>{f(!0);try{const s=["youtube","tiktok","instagram"],t=await Promise.allSettled(s.map(a=>u.getVideosByPlatform(a,1))),l={};t.forEach((a,D)=>{const j=s[D];a.status==="fulfilled"?l[j]=a.value.videos||[]:(l[j]=[],console.error(`Failed to fetch ${j} videos:`,a.reason))}),y(l)}catch(s){console.error("Error fetching videos:",s),i.error("Failed to fetch videos")}finally{f(!1)}},x=s=>{const{name:t,value:l}=s.target;b(a=>({...a,[t]:l}))},S=async s=>{s.preventDefault(),g(!0);try{await u.addVideo(c),i.success("Video added successfully"),n(!1),b({platform:"youtube",originalUrl:"",addedBy:d?.displayName||d?.email||"Admin"}),h()}catch(t){console.error("Error adding video:",t),i.error(t.message||"Failed to add video")}finally{g(!1)}},C=async s=>{try{await u.refreshVideoStats(s),i.success("Video stats refreshed"),h()}catch(t){console.error("Error refreshing video stats:",t),i.error("Failed to refresh video stats")}},w=async s=>{try{await u.deleteVideo(s),i.success("Video deleted"),h()}catch(t){console.error("Error deleting video:",t),i.error(t.message||"Failed to delete video")}};r.useEffect(()=>{h()},[]);const U=s=>{switch(s){case"youtube":return"red";case"tiktok":return"pink";case"instagram":return"purple";default:return"blue"}},F=s=>s?new Date(s).toLocaleDateString():"N/A",p=s=>s?s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(1)}K`:s.toString():"0";return e.jsxs("div",{className:`admin-videos-page ${N?"dark":""}`,children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Videos Management"}),e.jsx("button",{className:"add-video-btn",onClick:()=>n(!0),children:"Add Video"})]}),e.jsx("div",{className:"platform-tabs",children:["youtube","tiktok","instagram"].map(s=>e.jsxs("button",{className:`tab-btn ${o===s?"active":""} ${U(s)}`,onClick:()=>V(s),children:[s.charAt(0).toUpperCase()+s.slice(1),e.jsxs("span",{className:"video-count",children:["(",m[s]?.length||0,")"]})]},s))}),e.jsx("div",{className:"videos-table-container",children:k?e.jsx("div",{className:"loading-spinner",children:"Loading videos..."}):e.jsxs("table",{className:"videos-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Thumbnail"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Author"}),e.jsx("th",{children:"Views"}),e.jsx("th",{children:"Likes"}),e.jsx("th",{children:"Added"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:m[o]?.length>0?m[o].map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("img",{src:s.thumbnailUrl||"/placeholder-video.jpg",alt:s.title,className:"video-thumbnail"})}),e.jsxs("td",{children:[e.jsx("div",{className:"video-title",children:s.title||"Untitled"}),e.jsx("div",{className:"video-url",children:e.jsx("a",{href:s.originalUrl,target:"_blank",rel:"noopener noreferrer",children:"View Original"})})]}),e.jsx("td",{children:e.jsxs("div",{className:"author-info",children:[e.jsx("div",{className:"author-name",children:s.authorName||"Unknown"}),e.jsxs("div",{className:"author-user",children:["@",s.authorUser||"unknown"]})]})}),e.jsx("td",{children:p(s.views)}),e.jsx("td",{children:p(s.likes)}),e.jsx("td",{children:F(s.createdAt)}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"refresh-btn",onClick:()=>C(s.id),title:"Refresh Stats",children:"Refresh"}),e.jsx("button",{className:"delete-btn",onClick:()=>w(s.id),title:"Delete Video",children:"Delete"})]})})]},s.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"no-videos",children:["No videos found for ",o]})})})]})}),A&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Add New Video"}),e.jsx("button",{className:"close-btn",onClick:()=>n(!1),children:"Ã—"})]}),e.jsxs("form",{onSubmit:S,className:"video-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"platform",children:"Platform"}),e.jsxs("select",{id:"platform",name:"platform",value:c.platform,onChange:x,required:!0,children:[e.jsx("option",{value:"youtube",children:"YouTube"}),e.jsx("option",{value:"tiktok",children:"TikTok"}),e.jsx("option",{value:"instagram",children:"Instagram"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"originalUrl",children:"Video URL"}),e.jsx("input",{type:"url",id:"originalUrl",name:"originalUrl",value:c.originalUrl,onChange:x,placeholder:"https://...",required:!0}),e.jsx("small",{children:"Enter the full URL of the video"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"addedBy",children:"Added By"}),e.jsx("input",{type:"text",id:"addedBy",name:"addedBy",value:c.addedBy,onChange:x,required:!0})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>n(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:v,children:v?"Adding...":"Add Video"})]})]})]})})]})};export{R as default};
