import{C as X,D as Y,ad as Z,r,j as e,ae as G,af as ee,c6 as se,v,bM as te,y as l}from"./index-CDuOHj3I.js";import{R as ae}from"./RichTextEditor-DhDbze3n.js";import{A as re}from"./AdminLayout-B2_HOb6I.js";import{f as le,c as ne,u as oe}from"./promptsApi-BDedM9HX.js";import"./MenuBar-Np-EM3wI.js";import"./purify.es-DxJI3Wx7.js";const he=()=>{const{id:c}=X(),w=Y(),{user:ie}=Z(),m=r.useRef(null),n=c==="new",[p,k]=r.useState(""),[x,C]=r.useState(""),[P,E]=r.useState(""),[S,T]=r.useState(""),[o,h]=r.useState([]),[I,F]=r.useState(""),[i,g]=r.useState([]),[A,D]=r.useState(""),[L,R]=r.useState(""),[M,q]=r.useState(!1),[f,K]=r.useState(null),[b,y]=r.useState(""),[j,B]=r.useState(!1),[U,H]=r.useState(!n),[d,u]=r.useState(null),$=["AI Prompts","ChatGPT Prompts","AI Art Generator","Coding Assistant","Business Plan","Creative Writing","Marketing","Productivity","Education","Content Creation"];r.useEffect(()=>{if(n)return;(async()=>{try{H(!0);const s=await le(c);s?(k(s.title||""),C(s.description||""),E(s.link||""),T(s.category||""),h(s.keywords||[]),g(s.tags||[]),R(s.additionalHTML||""),q(s.isFeatured||!1),s.image&&y(s.image)):(u("Failed to load prompt data"),l.error("Failed to load prompt data"))}catch(s){console.error("Error fetching prompt:",s),u("Error loading prompt data. Please try again."),l.error("Error loading prompt data")}finally{H(!1)}})()},[c,n]);const z=t=>{const s=t.target.files[0];if(!s)return;if(s.size>5*1024*1024){l.error("Image is too large. Maximum size is 5MB.");return}K(s);const a=new FileReader;a.onloadend=()=>{y(a.result)},a.readAsDataURL(s)},O=()=>{K(null),y(""),m.current&&(m.current.value="")},_=t=>{if(t.key==="Enter"||t.key===","){t.preventDefault();const s=I.trim();s&&!o.includes(s)&&(h([...o,s]),F(""))}},J=t=>{h(o.filter((s,a)=>a!==t))},W=t=>{if(t.key==="Enter"||t.key===","){t.preventDefault();const s=A.trim();s&&!i.includes(s)&&(g([...i,s]),D(""))}},Q=t=>{g(i.filter((s,a)=>a!==t))},V=async t=>{if(t.preventDefault(),!p||!x){l.error("Title and description are required");return}try{B(!0),u(null);const s={title:p,description:x,link:P||"",category:S||"",keywords:o||[],tags:i||[],additionalHTML:L||"",isFeatured:M};let a;n?(a=await ne(s,f),l.success("Prompt created successfully")):(a=await oe(c,s,f),l.success("Prompt updated successfully")),a&&w("/admin/prompts")}catch(s){console.error("Error saving prompt:",s);let a="Error saving prompt. Please try again.",N=null;s.response?(a=`Server error: ${s.response.status} ${s.response.statusText}`,N={status:s.response.status,statusText:s.response.statusText,data:s.response.data,headers:s.response.headers},console.error("Response error details:",N)):s.request?(a="No response received from server. Please check your network connection.",console.error("Request was made but no response received:",s.request)):(a=`Request setup error: ${s.message}`,console.error("Error setting up request:",s.message)),u({message:a,details:N||s.message}),l.error(a)}finally{B(!1)}};return U?e.jsxs("div",{className:"admin-prompt-edit p-6 flex justify-center items-center h-screen",children:[e.jsx(G,{className:"animate-spin text-3xl text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Loading prompt data..."})]}):e.jsx(re,{children:e.jsx("div",{className:"admin-prompt-edit-page",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs("button",{onClick:()=>w("/admin/prompts"),className:"flex items-center text-blue-600 hover:text-blue-800 mr-4",children:[e.jsx(ee,{className:"mr-2"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold",children:n?"Create New Prompt":"Edit Prompt"})]}),d&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:typeof d=="string"?e.jsx("p",{children:d}):e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:d.message}),d.details&&e.jsx("div",{className:"mt-2",children:e.jsxs("details",{className:"cursor-pointer",children:[e.jsx("summary",{className:"font-medium text-sm",children:"Show technical details"}),e.jsx("pre",{className:"mt-2 p-2 bg-red-50 text-xs overflow-auto max-h-64 rounded",children:JSON.stringify(d.details,null,2)})]})})]})}),e.jsxs("form",{onSubmit:V,className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Basic Information"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Title *"}),e.jsx("input",{type:"text",value:p,onChange:t=>k(t.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"Enter prompt title",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Description *"}),e.jsx("textarea",{value:x,onChange:t=>C(t.target.value),className:"w-full p-2 border border-gray-300 rounded-md h-24",placeholder:"Enter a brief description",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Category"}),e.jsxs("select",{value:S,onChange:t=>T(t.target.value),className:"w-full p-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Select a category"}),$.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"External Link"}),e.jsx("input",{type:"text",value:P,onChange:t=>E(t.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"https://example.com"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:t=>q(t.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-gray-700 font-medium",children:"Featured Prompt"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Featured prompts appear in the featured section"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Image"}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("button",{type:"button",onClick:()=>m.current?.click(),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 flex items-center",children:[e.jsx(se,{className:"mr-2"}),f?"Change Image":"Upload Image"]}),b&&e.jsxs("button",{type:"button",onClick:O,className:"ml-4 text-red-600 hover:text-red-800",children:[e.jsx(v,{}),e.jsx("span",{className:"ml-1",children:"Remove"})]}),e.jsx("input",{type:"file",ref:m,onChange:z,accept:"image/*",className:"hidden"})]}),b&&e.jsx("div",{className:"mt-4 relative",children:e.jsx("img",{src:b,alt:"Preview",className:"w-full max-w-md h-auto rounded-md"})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Keywords & Tags"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Keywords"}),e.jsx("input",{type:"text",value:I,onChange:t=>F(t.target.value),onKeyDown:_,className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"Type keyword and press Enter or comma"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Press Enter or comma to add keywords"}),o.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:o.map((t,s)=>e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800",children:[t,e.jsx("button",{type:"button",onClick:()=>J(s),className:"ml-2 text-blue-600 hover:text-blue-800",children:e.jsx(v,{className:"h-3 w-3"})})]},s))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Tags"}),e.jsx("input",{type:"text",value:A,onChange:t=>D(t.target.value),onKeyDown:W,className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"Type tag and press Enter or comma"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Press Enter or comma to add tags"}),i.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:i.map((t,s)=>e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800",children:[t,e.jsx("button",{type:"button",onClick:()=>Q(s),className:"ml-2 text-green-600 hover:text-green-800",children:e.jsx(v,{className:"h-3 w-3"})})]},s))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Prompt Content"}),e.jsx(ae,{content:L,onChange:t=>R(t)})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:j,className:"px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:[j&&e.jsx(G,{className:"animate-spin mr-2"}),e.jsx(te,{className:j?"hidden":"mr-2"}),n?"Create Prompt":"Save Changes"]})})]})]})})})};export{he as default};
