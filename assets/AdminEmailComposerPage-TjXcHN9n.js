import{r as l,y as v,j as e,bg as H,as as X,bt as Z,aC as ee,c3 as se,aL as ae,a9 as te}from"./index-CDuOHj3I.js";import{A as le}from"./AdminLayout-B2_HOb6I.js";import{H as M,a as ie}from"./emailService-BhUQ5SQa.js";import{f as ne}from"./adminManageUsersApi-DPG9IZoO.js";import{R as re}from"./RichTextEditor-DhDbze3n.js";import"./MenuBar-Np-EM3wI.js";import"./purify.es-DxJI3Wx7.js";const je=()=>{const[r,d]=l.useState(""),[b,m]=l.useState(""),[h,u]=l.useState(""),[i,_]=l.useState("update"),[y,B]=l.useState(!1),[p,w]=l.useState([]),[C,O]=l.useState(""),[E,z]=l.useState([]),[c,k]=l.useState([]),[A,T]=l.useState(!1),[n,I]=l.useState(1),[S,Q]=l.useState(10),[U,F]=l.useState(!1),[Y,L]=l.useState(!1);l.useEffect(()=>{q()},[]),l.useEffect(()=>{if(C.trim()==="")k(E);else{const s=C.toLowerCase(),a=E.filter(t=>t.email.toLowerCase().includes(s)||t.username&&t.username.toLowerCase().includes(s)||t.firstName&&t.firstName.toLowerCase().includes(s)||t.lastName&&t.lastName.toLowerCase().includes(s));k(a)}I(1)},[C,E]);const q=async()=>{L(!0);try{const s=await ne(1,100,"","createdAt","desc");z(s.users||[]),k(s.users||[])}catch(s){console.error("Error loading users:",s),v.error("Failed to load users. Please try again.")}finally{L(!1)}},f=s=>{switch(_(s),s){case"update":d("Weekly AI Waverider Update"),m("Weekly AI Waverider Update"),u("Here are the latest updates from AI Waverider this week...");break;case"agent":d("New AI Agents Available - AI Waverider"),m("New AI Agents Available"),u("<p>We're excited to announce new AI agents on our platform!</p>");break;case"tool":d("New AI Tools Released - AI Waverider"),m("New AI Tools Released"),u("<p>Check out our latest AI tools that have just been released:</p><ul><li><strong>Tool 1</strong>: Description of the first tool</li><li><strong>Tool 2</strong>: Description of the second tool</li></ul>");break;case"announcement":d("Important Announcement from AI Waverider"),m("Important Announcement"),u("We have an important announcement to share with you...");break;case"custom":d(""),m(""),u("");break}},R=s=>{w(a=>a.includes(s)?a.filter(t=>t!==s):[...a,s])},J=()=>{w(A?[]:$.map(s=>s.id)),T(!A)},P=n*S,W=P-S,$=c.slice(W,P),j=Math.ceil(c.length/S),N=s=>{I(s),T(!1)},K=s=>{Q(Number(s.target.value)),I(1)},G=()=>{B(!y)},V=async()=>{if(!r||!h){v.error("Please provide both a subject and content for your email");return}if(p.length===0){v.error("Please select at least one recipient");return}F(!0);try{const s=p.map(t=>c.find(o=>o.id===t)||null).filter(Boolean);if(s.length===0)throw new Error("No valid recipients selected");let a;if(i==="custom"||i==="agent"||i==="tool"){const t=s.map(g=>g.email).filter(Boolean);if(t.length===0)throw new Error("No valid email addresses found for selected recipients");const x=s.map(g=>g.id).filter(Boolean),o={recipientType:"specific",recipients:t.join(","),recipientUsersData:s,userIds:x,emailType:i};i==="agent"||i==="tool"?(o.title=r,o.headerTitle=b||r,o.content=h,o.updateType=i==="agent"?"new_agents":"new_tools"):(o.subject=r,o.headerTitle=b||r,o.content=h);try{a=await ie(o)}catch(g){throw console.error(`Error sending ${i} email:`,g),g}}else{const t=s.map(x=>x.id);if(a=await fetch("https://api.aiwaverider.com/api/email/update/users",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({title:r,headerTitle:b||r,content:h,updateType:i,userIds:t})}),!a.ok){const x=await a.json().catch(()=>null);throw new Error(x?.message||`Failed to send email: ${a.status} ${a.statusText}`)}a=await a.json()}a.data&&a.data.sentCount?v.success(`Email successfully sent to ${a.data.sentCount} recipients!`):v.success("Email sent successfully!"),d(""),m(""),u(""),w([]),T(!1)}catch(s){console.error("Error sending email:",s),v.error(s.message||"Failed to send email")}finally{F(!1)}},D=s=>s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.username?s.username:s.displayName?s.displayName:s.email.split("@")[0];return e.jsx(le,{children:e.jsxs("div",{className:"email-composer",children:[e.jsxs("h1",{children:[e.jsx(H,{})," Email Composer"]}),U&&e.jsxs("div",{className:"loading-container",children:[e.jsx(M,{color:"#4FD1C5",size:50}),e.jsx("p",{children:"Sending emails..."})]}),e.jsxs("div",{className:"composer-container",children:[e.jsxs("div",{className:"email-composition",children:[e.jsxs("div",{className:"email-type-selector",children:[e.jsx("button",{className:i==="update"?"active":"",onClick:()=>f("update"),children:"Weekly Update"}),e.jsxs("button",{className:i==="agent"?"active":"",onClick:()=>f("agent"),children:[e.jsx(X,{})," AI Agents"]}),e.jsxs("button",{className:i==="tool"?"active":"",onClick:()=>f("tool"),children:[e.jsx(Z,{})," AI Tools"]}),e.jsx("button",{className:i==="announcement"?"active":"",onClick:()=>f("announcement"),children:"Announcement"}),e.jsx("button",{className:i==="custom"?"active":"",onClick:()=>f("custom"),children:"Custom Email"})]}),y?e.jsxs("div",{className:"email-preview",children:[e.jsx("div",{className:"preview-header",children:e.jsx("h3",{children:"Email Preview"})}),e.jsxs("div",{className:"preview-subject",children:[e.jsx("strong",{children:"Subject:"})," ",r]}),e.jsx("div",{className:"preview-content",dangerouslySetInnerHTML:{__html:h}})]}):e.jsxs("div",{className:"email-editor",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"email-subject",children:"Email Subject (appears in inbox)"}),e.jsx("input",{type:"text",id:"email-subject",placeholder:"Enter email subject...",value:r,onChange:s=>d(s.target.value),"aria-label":"Email subject"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"email-header-title",children:"Email Header Title (appears at the top of the email)"}),e.jsx("input",{type:"text",id:"email-header-title",placeholder:"Enter email header title...",value:b,onChange:s=>m(s.target.value),"aria-label":"Email header title"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"email-content",children:"Email Content"}),e.jsx("div",{className:"editor-container",children:e.jsx(re,{value:h,onChange:u,placeholder:"Compose your email content here..."})}),e.jsxs("div",{className:"placeholder-help",children:[e.jsx("p",{children:e.jsx("strong",{children:"Available placeholders:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"{{name}}"}),` - Recipient's first name or "there" if not available`]}),e.jsxs("li",{children:[e.jsx("code",{children:"{{websiteUrl}}"})," - Your website URL"]}),e.jsxs("li",{children:[e.jsx("code",{children:"{{supportEmail}}"})," - Support email address"]}),e.jsxs("li",{children:[e.jsx("code",{children:"{{currentYear}}"})," - Current year (for copyright)"]})]})]})]})]}),e.jsxs("div",{className:"editor-actions",children:[e.jsx("button",{className:"preview-button",onClick:G,"aria-label":y?"Edit email":"Preview email",children:y?e.jsxs(e.Fragment,{children:[e.jsx(H,{})," Edit"]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{})," Preview"]})}),e.jsxs("button",{className:"send-button",onClick:V,disabled:U||p.length===0||!r||!h,"aria-label":"Send email to selected recipients",children:[e.jsx(se,{})," Send Email (",p.length,")"]})]})]}),e.jsxs("div",{className:"recipient-selector",children:[e.jsxs("h2",{children:[e.jsx(ae,{})," Select Recipients"]}),e.jsx("div",{className:"recipient-actions",children:e.jsxs("div",{className:"search-container",children:[e.jsxs("div",{className:"search-wrapper",children:[e.jsx(te,{className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:C,onChange:s=>O(s.target.value),className:"search-input"})]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsxs("div",{className:"items-per-page",children:[e.jsx("span",{children:"Show: "}),e.jsxs("select",{value:S,onChange:K,className:"page-selector",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsx("button",{className:`select-all-btn ${A?"active":""}`,onClick:J,type:"button",children:A?"Deselect All":"Select All"})]})]})}),e.jsx("div",{className:"user-list",children:Y?e.jsxs("div",{className:"loading-users",children:[e.jsx(M,{size:30,color:"#4FD1C5"}),e.jsx("span",{children:"Loading users..."})]}):c.length===0?e.jsx("div",{className:"no-users",children:"No users found"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"user-list-header",children:[e.jsx("div",{className:"user-avatar"}),e.jsx("div",{className:"user-name",children:"Name"}),e.jsx("div",{className:"user-email",children:"Email"})]}),$.map(s=>e.jsxs("div",{className:`recipient-item ${p.includes(s.id)?"selected":""}`,onClick:()=>R(s.id),role:"checkbox","aria-checked":p.includes(s.id),tabIndex:0,onKeyPress:a=>{(a.key==="Enter"||a.key===" ")&&R(s.id)},children:[e.jsx("div",{className:"user-avatar",children:s.photoURL?e.jsx("img",{src:s.photoURL,alt:D(s),className:"avatar-img"}):e.jsx("div",{className:"avatar-placeholder",children:s.firstName?.charAt(0)||s.username?.charAt(0)||"?"})}),e.jsx("div",{className:"user-name",children:D(s)}),e.jsx("div",{className:"user-email",children:s.email}),e.jsx("div",{className:"select-indicator"})]},s.id))]})}),e.jsxs("div",{className:"selected-count",children:[p.length," recipients selected"]})]}),c.length>10&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>N(1),disabled:n===1,className:"pagination-button",children:"««"}),e.jsx("button",{onClick:()=>N(n-1),disabled:n===1,className:"pagination-button",children:"«"}),Array.from({length:Math.min(5,j)},(s,a)=>{let t;return j<=5||n<=3?t=a+1:n>=j-2?t=j-4+a:t=n-2+a,e.jsx("button",{onClick:()=>N(t),className:`pagination-button ${n===t?"active":""}`,children:t},t)}),e.jsx("button",{onClick:()=>N(n+1),disabled:n===j,className:"pagination-button",children:"»"}),e.jsx("button",{onClick:()=>N(j),disabled:n===j,className:"pagination-button",children:"»»"}),e.jsx("div",{className:"pagination-info",children:c.length>0?e.jsxs("span",{children:["Showing ",W+1,"-",Math.min(P,c.length)," of ",c.length," users"]}):e.jsx("span",{children:"No users found"})})]})]})]})})};export{je as default};
