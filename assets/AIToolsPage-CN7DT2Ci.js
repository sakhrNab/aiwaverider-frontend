import{a8 as te,t as ae,r as g,A as se,D as oe,j as t,H as re,a9 as ne,v as ie,aa as le,ab as ce}from"./index-CDuOHj3I.js";import{d as de,v as he,m as ge,e as ue,a as me,h as fe,r as pe,t as xe}from"./default-ai-icon-hgQ70KUj.js";import{g as be}from"./aiToolsService-BmhsXtqf.js";const B="ai_tools_cache",z="ai_tools_cache_timestamp",we=3600*1e3,q=300*1e3,ye=te((d,l)=>({tools:[],isLoaded:!1,isLoading:!1,error:null,unsubscribe:null,lastRefreshed:null,pagination:{currentPage:1,pageSize:12,totalItems:0,totalPages:1,hasMore:!1},startListening:()=>{if(l().unsubscribe){console.log("AI Tools polling already active");return}try{const a=l().loadFromCache(),o=Date.now();if(a&&a.tools&&a.tools.length>0){const n=!l().isCacheExpired(a.timestamp);d({tools:a.tools,isLoaded:!0,isLoading:!1,lastRefreshed:a.timestamp}),console.log(`Loaded ${a.tools.length} AI tools from cache, expired: ${!n}`),n||l().fetchToolsOnce(!0,!1)}else d({isLoading:!0,error:null}),l().fetchToolsOnce(!1,!0);const r=setInterval(()=>{if(document.visibilityState==="visible"){const{lastRefreshed:n}=l();(n?o-n:1/0)>q&&l().fetchToolsOnce(!0,!1)}},q);d({unsubscribe:()=>clearInterval(r)})}catch(a){console.error("Error setting up AI tools polling:",a),d({error:a.message||"Failed to set up AI tools polling",isLoading:!1}),l().fetchToolsOnce(!1,!0)}},stopListening:()=>{const a=l().unsubscribe;a&&(a(),console.log("AI Tools polling stopped"),d({unsubscribe:null}))},fetchToolsOnce:async(a=!1,o=!0)=>{const{isLoaded:r,lastRefreshed:n,tools:m}=l();if(!a&&r&&n&&Date.now()-n<3e5&&m.length>0)return console.log("Skipping fetch, using recently loaded tools"),m;o&&d({isLoading:!0,error:null});try{if(!a){const h=l().loadFromCache();if(h&&!l().isCacheExpired(h.timestamp))return d({tools:h.tools,isLoaded:!0,isLoading:!1,lastRefreshed:h.timestamp}),console.log("Loaded AI tools from cache (manual fetch):",h.tools.length),h.tools}const f=navigator.onLine;let c=[];if(f)try{c=await be(a),console.log(`Fetched AI tools from API (online): ${c.length} tools`)}catch(h){console.error("Error fetching from API, falling back to offline data:",h);const y=await l().loadFromIndexedDB();y&&y.length>0&&(c=y,console.log("Loaded from IndexedDB after API failure:",c.length))}else{console.log("Device is offline, using IndexedDB data");const h=await l().loadFromIndexedDB();h&&h.length>0&&(c=h,d({error:"Currently in offline mode. Data may not be up to date."}))}if(!c||c.length===0)return console.log("No AI tools data available from any source, showing empty state"),d({isLoading:!1,error:f?"Failed to load AI tools data":"No offline data available"}),[];c.sort((h,y)=>{const P=h.createdAt?new Date(h.createdAt):new Date(0);return(y.createdAt?new Date(y.createdAt):new Date(0))-P});const w=c.length,{pageSize:N}=l().pagination,b=Math.max(1,Math.ceil(w/N)),L=Math.min(l().pagination.currentPage,b),k=L<b;return d({tools:c,isLoaded:!0,isLoading:!1,lastRefreshed:Date.now(),error:null,pagination:{pageSize:N,totalItems:w,totalPages:b,currentPage:L,hasMore:k}}),l().saveToCache(c),console.log("Fetched AI tools from API:",c.length),c}catch(f){return console.error("Error fetching AI tools once:",f),d({error:f.message||"Failed to load AI tools",isLoading:!1}),[]}},saveToCache:a=>{try{if(!a||a.length===0){console.log("Skipping cache update - no AI tools to cache");return}const o=Date.now(),r={tools:a,timestamp:o},n=l().loadFromCache();if(n&&n.tools&&n.tools.length===a.length&&o-n.timestamp<900*1e3){console.log("Skipping cache update - recent cache exists with same item count");return}localStorage.setItem(B,JSON.stringify(r)),localStorage.setItem(z,o.toString()),l().saveToIndexedDB(a),console.log(`Updated AI tools cache with ${a.length} tools`)}catch(o){console.error("Error saving AI tools to cache:",o)}},saveToIndexedDB:a=>{try{if(!window.indexedDB){console.log("IndexedDB not supported - offline functionality limited");return}const o=window.indexedDB.open("AIWaveriderOfflineDB",1);o.onupgradeneeded=r=>{const n=r.target.result;n.objectStoreNames.contains("aiTools")||n.createObjectStore("aiTools",{keyPath:"id"}).createIndex("createdAt","createdAt",{unique:!1})},o.onsuccess=r=>{const m=r.target.result.transaction(["aiTools"],"readwrite"),f=m.objectStore("aiTools");f.clear(),a.forEach(c=>{f.add(c)}),m.oncomplete=()=>{console.log(`Saved ${a.length} AI tools to IndexedDB for offline use`)},m.onerror=c=>{console.error("IndexedDB transaction error:",c)}},o.onerror=r=>{console.error("Error opening IndexedDB:",r)}}catch(o){console.error("Error saving to IndexedDB:",o)}},loadFromIndexedDB:()=>new Promise(a=>{try{if(!window.indexedDB){console.log("IndexedDB not supported - offline functionality limited"),a(null);return}const o=window.indexedDB.open("AIWaveriderOfflineDB",1);o.onupgradeneeded=r=>{const n=r.target.result;n.objectStoreNames.contains("aiTools")||n.createObjectStore("aiTools",{keyPath:"id"})},o.onsuccess=r=>{const n=r.target.result;if(!n.objectStoreNames.contains("aiTools")){a(null);return}const c=n.transaction(["aiTools"],"readonly").objectStore("aiTools").getAll();c.onsuccess=()=>{const w=c.result;w&&w.length>0?(console.log(`Loaded ${w.length} AI tools from IndexedDB (offline)`),a(w)):a(null)},c.onerror=()=>{a(null)}},o.onerror=()=>{a(null)}}catch(o){console.error("Error in loadFromIndexedDB:",o),a(null)}}),loadFromCache:()=>{try{const a=localStorage.getItem(B);return a?JSON.parse(a):null}catch(a){return console.error("Error loading AI tools from cache:",a),null}},isCacheExpired:a=>a?Date.now()-a>we:!0,clearCache:()=>{try{localStorage.removeItem(B),localStorage.removeItem(z),console.log("AI tools cache cleared")}catch(a){console.error("Error clearing AI tools cache:",a)}},forceRefresh:async()=>{console.log("Force refreshing AI tools..."),l().clearCache(),d(a=>({pagination:{...a.pagination,currentPage:1}})),d({isLoading:!0}),await l().fetchToolsOnce(!0,!0),d({isLoading:!1}),console.log("AI tools refreshed successfully")},setPage:a=>{const{pagination:o}=l();a===o.currentPage||a<1||a>o.totalPages||d(r=>({pagination:{...r.pagination,currentPage:a}}))},setPageSize:a=>{a<4||a>100||d(o=>{const r=Math.max(1,Math.ceil(o.pagination.totalItems/a)),n=Math.min(o.pagination.currentPage,r);return{pagination:{...o.pagination,pageSize:a,totalPages:r,currentPage:n,hasMore:n<r}}})},getPaginatedTools:()=>{const{tools:a,pagination:o}=l();if(!a||a.length===0)return[];const r=(o.currentPage-1)*o.pageSize,n=r+o.pageSize;return a.slice(r,n)}}));var Ie={};const Ae="bg-gradient-to-br from-[#4158D0] via-[#C850C0] to-[#FFCC70] stars-pattern",A={"Text Effects":xe,Relight:pe,Hedra:fe,Ads:me,Eraser:ue,"Mind Map":ge,Viral:he,default:de},H=["All","Free tools","Video Generator","Animation","Make money with AI","3D tools","Content","AI Coding","Digital Influencer","Video Editing","Viral Video Hacks","Organization","Design","Audio","Automation"],v=new Map,Le=()=>{const{darkMode:d}=ae(),{user:l}=g.useContext(se);oe();const[a,o]=g.useState(""),[r,n]=g.useState(""),[m,f]=g.useState(["All"]),[c,w]=g.useState(Date.now()),N=l?.role==="admin",{tools:b,isLoading:L,error:k,isLoaded:h,startListening:y,stopListening:P,forceRefresh:M,lastRefreshed:F}=ye(e=>({tools:e.tools,isLoading:e.isLoading,error:e.error,isLoaded:e.isLoaded,startListening:e.startListening,stopListening:e.stopListening,forceRefresh:e.forceRefresh,lastRefreshed:e.lastRefreshed})),V=e=>e?e.startsWith("http://")||e.startsWith("https://")?e:`https://${e}`:"#",W=e=>{const s=e.target,{naturalWidth:i,naturalHeight:u}=s;u>i*1.2?(s.setAttribute("data-aspect","portrait"),s.classList.add("portrait-image")):i>u*1.2?(s.setAttribute("data-aspect","landscape"),s.classList.add("landscape-image")):(s.setAttribute("data-aspect","square"),s.classList.add("square-image")),s.classList.remove("img-loading"),s.classList.add("img-loaded"),s.src&&!s.src.startsWith("data:")&&v.set(s.src,{timestamp:Date.now(),loaded:!0})},U=()=>{M()},G=g.useCallback((e,s)=>{const i=e.target;i.onerror=null;const u=s.title?.split(" ")[0],x=A[u]||A[s.keyword]||A.default;i.src=x,i.setAttribute("data-aspect","square"),i.classList.remove("img-loading"),i.classList.add("img-loaded"),i.classList.add("square-image"),s.image&&v.set(s.image,{timestamp:Date.now(),loaded:!1,fallback:i.src})},[]),R=g.useCallback(e=>{if(!e.image||e.image==="/uploads/undefined"||e.image.includes("/undefined")||e.image==="")return null;let s=e.image;if(s.startsWith("/")&&(s=`${Ie.REACT_APP_API_URL||"http://localhost:4000"}${s}`),v.has(s)){const i=v.get(s);if(!i.loaded&&i.fallback)return i.fallback}return s},[]),_=g.useCallback(e=>{if(!e||e.length===0)return H;const s=["All"],i=new Set;e.forEach(x=>{x.category&&(Array.isArray(x.category)?x.category.forEach(j=>j&&i.add(j)):i.add(x.category)),Array.isArray(x.tags)&&x.tags.forEach(j=>j&&i.add(j))});const u=[...i];return[...s,...u]},[]);g.useEffect(()=>{y();const e=setInterval(()=>{const s=Date.now();v.forEach((i,u)=>{s-i.timestamp>36e5&&v.delete(u)}),w(s)},36e5);return()=>{clearInterval(e),P()}},[y,P]);const Y=()=>{M()};g.useEffect(()=>{if(b&&b.length>0){const e=_(b);f(e)}else f(H)},[b,_]);const C=b.filter(e=>{const s=e.title.toLowerCase().includes(a.toLowerCase()),i=e.description?.toLowerCase().includes(a.toLowerCase()),u=e.keyword?.toLowerCase().includes(a.toLowerCase()),x=e.keywords&&Array.isArray(e.keywords)?e.keywords.some(ee=>ee.toLowerCase().includes(a.toLowerCase())):!1,j=r===""||r==="All"||(Array.isArray(e.category)?e.category.includes(r):e.category===r)||e.tags&&e.tags.includes(r);return(s||i||u||x)&&j}),[D,S]=g.useState(1),[T,J]=g.useState(12),O=C.length,I=Math.max(1,Math.ceil(O/T)),$=(D-1)*T,K=$+T,Q=C.slice($,K),p={currentPage:D,pageSize:T,totalPages:I},E=e=>{S(Math.max(1,Math.min(e,I)))},X=e=>{const s=Math.max(4,Math.min(e,100));J(s);const i=Math.ceil(O/s);S(Math.min(D,i))};g.useEffect(()=>{S(1)},[a,r]),g.useEffect(()=>{D>I&&I>0&&S(I)},[T,I,D]);const Z=g.useCallback(e=>{const s=R(e);if(s)return s;const i=e.title?.split(" ")[0];return A[i]?A[i]:A[e.keyword]?A[e.keyword]:A.default},[R]);return L&&!h?t.jsxs("div",{className:"flex flex-col justify-center items-center h-screen bg-gradient-to-b from-gray-900 to-blue-900",children:[t.jsx("div",{className:"mb-8",children:t.jsx(re,{color:"#4FD1C5",size:70,speedMultiplier:.8})}),t.jsx("div",{className:"text-white text-xl font-semibold mt-4",children:"Loading AI Tools"}),t.jsx("div",{className:"text-blue-300 text-sm mt-2",children:"Discovering the best tools for you..."})]}):t.jsx("div",{className:`min-h-screen pb-16 ${d?"dark bg-[#2D1846]":"bg-gray-50"} ${Ae}`,children:t.jsx("main",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"max-w-6xl mx-auto mt-8",children:[t.jsxs("div",{className:"page-header-3d",children:[t.jsx("div",{className:"absolute inset-0 bg-pattern opacity-30"}),t.jsxs("div",{className:"relative z-10",children:[t.jsx("h1",{className:"text-4xl sm:text-5xl font-bold text-center mb-4 tracking-tight",children:t.jsx("span",{className:"bg-gradient-to-r from-purple-300 via-pink-300 to-yellow-200 text-transparent bg-clip-text",children:"AI Tools Directory"})}),t.jsx("p",{className:"text-white/80 text-center text-lg mb-2",children:"Discover the best AI tools to enhance your workflow"}),t.jsx("div",{className:"w-20 h-1 bg-gradient-to-r from-purple-500 to-pink-500 mx-auto mt-4 rounded-full"})]})]}),k?t.jsxs("div",{className:"text-center py-12 glass-effect rounded-2xl p-6",children:[t.jsx("p",{className:"text-red-400 text-lg mb-4",children:k}),t.jsx("button",{onClick:Y,className:"px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30 text-white transition-all",children:"Try Again"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex flex-col md:flex-row justify-between items-center mb-8 gap-4",children:t.jsxs("div",{className:"flex w-full md:w-auto gap-3",children:[t.jsxs("div",{className:"relative flex-1 md:flex-auto",id:"ai-tools-search",children:[t.jsx("input",{type:"text",placeholder:"Search AI tools...",value:a,onChange:e=>o(e.target.value),className:"search-input w-full md:w-72 px-4 py-3 pr-10 rounded-xl bg-white/10 backdrop-blur-md text-white shadow-lg"}),t.jsx(ne,{className:"search-icon absolute right-3 top-1/2 transform -translate-y-1/2 text-white/70"}),a&&t.jsx("button",{type:"button",className:"search-clear-button",onClick:()=>o(""),"aria-label":"Clear search",children:t.jsx(ie,{})})]}),N&&t.jsxs("button",{onClick:U,className:"p-3 rounded-xl bg-white/10 backdrop-blur-md hover:bg-white/20 text-white shadow-lg transition-all duration-300 flex items-center justify-center tooltip-container","aria-label":"Refresh data",title:F?`Last updated: ${new Date(F).toLocaleTimeString()}`:"Refresh data",children:[t.jsx(le,{className:L?"animate-spin":"animate-spin-on-hover"}),t.jsx("span",{className:"tooltip",children:"Refresh"})]})]})}),b.length>0&&t.jsxs("div",{className:"filter-tags-container",children:[t.jsx("button",{onClick:()=>n(""),className:`filter-button ${r===""?"active":""}`,children:"All"}),m.filter(e=>e!=="All").sort((e,s)=>e.localeCompare(s)).map(e=>t.jsx("button",{onClick:()=>n(e),className:`filter-button ${r===e?"active":""}`,children:e},e))]}),b.length>0?t.jsxs("div",{className:"glass-effect rounded-3xl p-6 shadow-xl transform transition-transform duration-700 hover:scale-[1.01]",children:[t.jsx("div",{className:"content-grid",children:C.length===0?t.jsx("div",{className:"col-span-2 text-center py-12",children:t.jsx("p",{className:"text-white/70",children:"No tools match your search criteria. Try adjusting your filters."})}):Q.map((e,s)=>{const i=Z(e);return t.jsxs("a",{href:V(e.url||e.link),target:"_blank",rel:"noopener noreferrer",className:"ai-tool-card glass-effect stable-card",children:[t.jsx("div",{className:"tool-icon-container",children:t.jsx("img",{src:i,alt:e.title,className:"img-loading w-full h-full object-cover",onLoad:W,onError:u=>G(u,e),loading:"lazy"})}),t.jsxs("div",{className:"ai-tool-content",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h3",{className:"ai-tool-title",children:e.title}),t.jsx(ce,{className:"external-link-icon"})]}),t.jsx("p",{className:"ai-tool-description",children:e.description}),t.jsxs("div",{className:"ai-tool-tags",children:[t.jsx("span",{className:"ai-tool-primary-tag",children:Array.isArray(e.category)&&e.category.length>0?e.category[0]:e.category||(e.keywords&&e.keywords.length>0?e.keywords[0]:e.keyword)||"AI Tool"}),e.tags?.slice(0,2).map((u,x)=>t.jsx("span",{className:"ai-tool-secondary-tag",children:u},x))]})]})]},e.id||`tool-${s}`)})}),C.length>0&&t.jsxs("div",{className:"flex justify-center items-center mt-8 pagination-controls",children:[I>1&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>E(1),disabled:p.currentPage===1,className:"px-3 py-2 rounded-lg bg-white/10 backdrop-blur-md hover:bg-white/20 text-white shadow-lg transition-all duration-300 mx-1 disabled:opacity-50 disabled:cursor-not-allowed",children:"First"}),t.jsx("button",{onClick:()=>E(p.currentPage-1),disabled:p.currentPage===1,className:"px-3 py-2 rounded-lg bg-white/10 backdrop-blur-md hover:bg-white/20 text-white shadow-lg transition-all duration-300 mx-1 disabled:opacity-50 disabled:cursor-not-allowed",children:"« Prev"}),t.jsxs("div",{className:"flex items-center mx-4",children:[t.jsx("span",{className:"text-white/80",children:"Page"}),t.jsx("span",{className:"mx-2 px-3 py-1 bg-white/20 rounded-md text-white font-medium",children:p.currentPage}),t.jsxs("span",{className:"text-white/80",children:["of ",p.totalPages]})]}),t.jsx("button",{onClick:()=>E(p.currentPage+1),disabled:p.currentPage===p.totalPages,className:"px-3 py-2 rounded-lg bg-white/10 backdrop-blur-md hover:bg-white/20 text-white shadow-lg transition-all duration-300 mx-1 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next »"}),t.jsx("button",{onClick:()=>E(p.totalPages),disabled:p.currentPage===p.totalPages,className:"px-3 py-2 rounded-lg bg-white/10 backdrop-blur-md hover:bg-white/20 text-white shadow-lg transition-all duration-300 mx-1 disabled:opacity-50 disabled:cursor-not-allowed",children:"Last"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:"text-white/80 mr-2",children:"Show:"}),t.jsxs("select",{value:p.pageSize,onChange:e=>X(Number(e.target.value)),className:"px-2 py-1 rounded-md bg-white/10 backdrop-blur-md text-white border border-white/20 focus:outline-none focus:ring-2 focus:ring-blue-500 [&>option]:bg-gray-800 [&>option]:text-white",children:[t.jsx("option",{value:"12",children:"12"}),t.jsx("option",{value:"24",children:"24"}),t.jsx("option",{value:"48",children:"48"})]}),I===1&&t.jsxs("span",{className:"ml-3 text-white/60 text-sm",children:["(Showing all ",C.length," items)"]})]})]}),!navigator.onLine&&t.jsx("div",{className:"mt-4 p-2 bg-amber-500/20 text-amber-200 rounded-lg text-center",children:t.jsx("p",{className:"text-sm font-medium",children:"You are currently offline. Viewing cached data."})})]}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("p",{className:"text-white/70 mb-4",children:"No AI tools found in the database."}),t.jsx("p",{className:"text-white/50 mb-6",children:"AI tools need to be added by an administrator."}),N&&t.jsx("a",{href:"/admin/ai-tools",className:"px-6 py-3 bg-gradient-to-r from-purple-500/60 to-pink-500/60 rounded-lg text-white font-medium hover:from-purple-500/80 hover:to-pink-500/80 transition-all duration-300",children:"Go to Admin Panel"})]})]})]})})})};export{Le as default};
