import{r as l,j as e,bg as ne,F as re,x as I,a9 as le,ae as v,bR as ie,ag as oe,Y as ce,bV as de,bW as ue,bX as he,as as me,bt as ge,y as b}from"./index-CDuOHj3I.js";import{A as xe}from"./AdminLayout-B2_HOb6I.js";import{f as je,c as pe,u as fe,d as Ne}from"./adminManageUsersApi-DPG9IZoO.js";const Ce=()=>{const[c,S]=l.useState([]),[d,u]=l.useState(!0),[D,h]=l.useState(null),[p,$]=l.useState(""),[a,r]=l.useState(null),[B,y]=l.useState(!1),[L,P]=l.useState(!1),[O,k]=l.useState(!1),[x,C]=l.useState([]),[F,M]=l.useState(!1),[W,A]=l.useState(!1),[j,R]=l.useState("weeklyUpdates"),[m,w]=l.useState({title:"",message:""}),[U,T]=l.useState(!1),[t,g]=l.useState({currentPage:1,totalPages:1,totalUsers:0,limit:10}),[i,q]=l.useState({sortBy:"createdAt",sortDirection:"desc"});l.useEffect(()=>{E()},[t.currentPage,t.limit,i,p]);const E=async()=>{u(!0),h(null);try{const s=await je(t.currentPage,t.limit,p,i.sortBy,i.sortDirection);S(s.users||[]),g({...t,totalPages:s.totalPages||1,totalUsers:s.total||0})}catch(s){console.error("Error loading users:",s),h(s.message||"Failed to load users. Please try again.")}finally{u(!1)}},z=s=>{const n=s.target.value;$(n),t.currentPage!==1&&g({...t,currentPage:1})},f=s=>{q(n=>n.sortBy===s?{sortBy:s,sortDirection:n.sortDirection==="asc"?"desc":"asc"}:{sortBy:s,sortDirection:"asc"}),t.currentPage!==1&&g({...t,currentPage:1})},H=s=>s?new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",Q=s=>{r(s),P(!0)},Y=()=>{r({username:"",email:"",role:"user",status:"active"}),k(!0)},G=s=>{r(s),y(!0)},J=async()=>{if(!a||!a.id){h("Cannot delete user: Missing user ID"),y(!1);return}try{u(!0),await Ne(a.id),S(c.filter(s=>s.id!==a.id)),c.length===1&&t.currentPage>1?g({...t,currentPage:t.currentPage-1}):E(),y(!1),r(null)}catch(s){console.error("Error deleting user:",s),h(s.message||"Failed to delete user. Please try again.")}finally{u(!1)}},V=async s=>{if(s.preventDefault(),!a){h("Cannot create user: Missing user data");return}try{u(!0),await pe(a),k(!1),r(null),g({...t,currentPage:1}),E()}catch(n){console.error("Error creating user:",n),h(n.message||"Failed to create user. Please try again.")}finally{u(!1)}},X=async s=>{if(s.preventDefault(),!a||!a.id){h("Cannot update user: Missing user ID");return}try{u(!0);const n=await fe(a.id,a);S(c.map(o=>o.id===a.id?n:o)),P(!1),r(null)}catch(n){console.error("Error updating user:",n),h(n.message||"Failed to update user. Please try again.")}finally{u(!1)}},N=s=>{s<1||s>t.totalPages||g({...t,currentPage:s})},_=s=>{const n=parseInt(s.target.value,100);g({...t,limit:n,currentPage:1})},K=s=>{C(n=>n.includes(s)?n.filter(o=>o!==s):[...n,s])},Z=()=>{C(F?[]:c.map(s=>s.id)),M(!F)},ee=()=>{if(x.length===0){b.error("Please select at least one user to send a notification");return}let s="",n="";switch(j){case"weeklyUpdates":s="Weekly AI Waverider Update",n="Here are the latest updates from AI Waverider this week...";break;case"newAgents":s="New AI Agents Available",n="We have added new AI agents to our platform...";break;case"newTools":s="New AI Tools Available",n="Check out these new AI tools we've added to our platform...";break;default:s="AI Waverider Update",n="Here are the latest updates from AI Waverider..."}w({title:s,message:n}),A(!0)},se=s=>{R(s.target.value)},ae=async s=>{if(s.preventDefault(),x.length===0){b.error("Please select at least one user to send a notification");return}if(!m.title||!m.message){b.error("Please provide both a title and message for the notification");return}T(!0);try{const n=await fetch("https://api.aiwaverider.com/api/email/update/users",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({title:m.title,content:m.message,updateType:j,userIds:x})});if(!n.ok)throw new Error(`Failed to send notification: ${n.status}`);const o=await n.json();b.success(`Notification sent to ${o.data.sentCount} users`),A(!1),C([]),M(!1),w({title:"",message:""})}catch(n){console.error("Error sending notification:",n),b.error(n.message)}finally{T(!1)}};return l.useEffect(()=>{!d&&c.length===0&&t.currentPage>1&&g(s=>({...s,currentPage:s.currentPage-1}))},[c,d,t.currentPage]),e.jsx(xe,{children:e.jsxs("div",{className:"manage-users-page",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("h1",{children:"Manage Users"}),e.jsxs("div",{className:"action-buttons-container",children:[e.jsxs("button",{className:"btn-notification",onClick:ee,disabled:x.length===0,children:[e.jsx(ne,{className:"mr-2"})," Send Update"]}),e.jsxs("button",{className:"btn-primary",onClick:Y,children:[e.jsx(re,{className:"mr-2"})," Add New User"]})]})]}),D&&e.jsxs("div",{className:"error-message",children:[e.jsx(I,{}),e.jsx("span",{children:D})]}),e.jsxs("div",{className:"filters-container",children:[e.jsxs("div",{className:"search-bar",children:[e.jsx(le,{className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Search users by name, email, or role...",value:p,onChange:z})]}),e.jsx("div",{className:"notification-selector",children:e.jsxs("select",{value:j,onChange:se,className:"notification-select",children:[e.jsx("option",{value:"weeklyUpdates",children:"Weekly Updates"}),e.jsx("option",{value:"newAgents",children:"New Agents"}),e.jsx("option",{value:"newTools",children:"New AI Tools"})]})}),e.jsxs("div",{className:"page-size-selector",children:[e.jsx("span",{children:"Show:"}),e.jsxs("select",{value:t.limit,onChange:_,children:[e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"25",children:"25"}),e.jsx("option",{value:"50",children:"50"})]}),e.jsx("span",{children:"per page"})]})]}),d&&c.length===0?e.jsxs("div",{className:"loading-message",children:[e.jsx(v,{className:"spinner"}),e.jsx("span",{children:"Loading users..."})]}):e.jsx("div",{className:"users-table-container",children:c.length===0?e.jsx("div",{className:"no-users-message",children:p?`No users found matching "${p}"`:"No users found. Create your first user by clicking 'Add New User'."}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"select-column",children:e.jsx("input",{type:"checkbox",checked:F,onChange:Z})}),e.jsx("th",{className:i.sortBy==="username"?`sorted-${i.sortDirection}`:"",onClick:()=>f("username"),children:"Username"}),e.jsx("th",{className:i.sortBy==="email"?`sorted-${i.sortDirection}`:"",onClick:()=>f("email"),children:"Email"}),e.jsx("th",{className:i.sortBy==="role"?`sorted-${i.sortDirection}`:"",onClick:()=>f("role"),children:"Role"}),e.jsx("th",{className:i.sortBy==="status"?`sorted-${i.sortDirection}`:"",onClick:()=>f("status"),children:"Status"}),e.jsx("th",{className:i.sortBy==="createdAt"?`sorted-${i.sortDirection}`:"",onClick:()=>f("createdAt"),children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:x.includes(s.id),onChange:()=>K(s.id)})}),e.jsx("td",{children:e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-avatar",children:s.photoURL?e.jsx("img",{src:ie(s.photoURL),alt:s.username}):e.jsx("div",{className:"avatar-placeholder",children:(s.firstName?.charAt(0)||s.username?.charAt(0)||"?").toUpperCase()})}),e.jsx("span",{children:s.username||s.displayName})]})}),e.jsx("td",{children:s.email}),e.jsx("td",{children:e.jsx("span",{className:`role-badge ${s.role}`,children:s.role})}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${s.status}`,children:s.status})}),e.jsx("td",{children:H(s.createdAt)}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-edit",onClick:()=>Q(s),title:"Edit user",children:e.jsx(oe,{})}),e.jsx("button",{className:"btn-delete",onClick:()=>G(s),title:"Delete user",disabled:s.role==="admin"&&c.filter(n=>n.role==="admin").length<=1,children:e.jsx(ce,{})})]})})]},s.id))})]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("div",{className:"pagination-info",children:c.length>0?`Showing ${(t.currentPage-1)*t.limit+1} to ${Math.min(t.currentPage*t.limit,t.totalUsers)} of ${t.totalUsers} users`:"No users to display on this page."}),e.jsxs("div",{className:"pagination-buttons",children:[e.jsx("button",{className:"pagination-button",onClick:()=>N(1),disabled:t.currentPage===1,title:"First page",children:"«"}),e.jsx("button",{className:"pagination-button",onClick:()=>N(t.currentPage-1),disabled:t.currentPage===1,title:"Previous page",children:e.jsx(de,{})}),Array.from({length:Math.min(5,t.totalPages)},(s,n)=>{let o;if(t.totalPages<=5)o=n+1;else{const te=Math.max(Math.min(t.currentPage-3,t.totalPages-5),0);o=n+1+te}return e.jsx("button",{className:`pagination-button ${t.currentPage===o?"active":""}`,onClick:()=>N(o),children:o},o)}),e.jsx("button",{className:"pagination-button",onClick:()=>N(t.currentPage+1),disabled:t.currentPage===t.totalPages,title:"Next page",children:e.jsx(ue,{})}),e.jsx("button",{className:"pagination-button",onClick:()=>N(t.totalPages),disabled:t.currentPage===t.totalPages,title:"Last page",children:"»"})]})]})]})}),O&&a&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"Create New User"}),e.jsxs("form",{onSubmit:V,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"username",children:"Username"}),e.jsx("input",{type:"text",id:"username",value:a.username,onChange:s=>r({...a,username:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:a.email,onChange:s=>r({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",id:"password",value:a.password||"",onChange:s=>r({...a,password:s.target.value}),required:!0}),e.jsx("small",{className:"form-helper-text",children:"Password must be at least 8 characters"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"firstName",children:"First Name"}),e.jsx("input",{type:"text",id:"firstName",value:a.firstName||"",onChange:s=>r({...a,firstName:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lastName",children:"Last Name"}),e.jsx("input",{type:"text",id:"lastName",value:a.lastName||"",onChange:s=>r({...a,lastName:s.target.value})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"role",children:"Role"}),e.jsxs("select",{id:"role",value:a.role,onChange:s=>r({...a,role:s.target.value}),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",value:a.status,onChange:s=>r({...a,status:s.target.value}),children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>k(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:d,children:d?e.jsx(v,{className:"spinner"}):"Create User"})]})]})]})}),L&&a&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"Edit User"}),e.jsxs("form",{onSubmit:X,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"username",children:"Username"}),e.jsx("input",{type:"text",id:"username",value:a.username||a.displayName||"",onChange:s=>r({...a,username:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:a.email,onChange:s=>r({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Password (leave blank to keep unchanged)"}),e.jsx("input",{type:"password",id:"password",value:a.password||"",onChange:s=>r({...a,password:s.target.value})}),e.jsx("small",{className:"form-helper-text",children:"If provided, password must be at least 8 characters"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"firstName",children:"First Name"}),e.jsx("input",{type:"text",id:"firstName",value:a.firstName||"",onChange:s=>r({...a,firstName:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lastName",children:"Last Name"}),e.jsx("input",{type:"text",id:"lastName",value:a.lastName||"",onChange:s=>r({...a,lastName:s.target.value})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"role",children:"Role"}),e.jsxs("select",{id:"role",value:a.role,onChange:s=>r({...a,role:s.target.value}),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",value:a.status,onChange:s=>r({...a,status:s.target.value}),children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>P(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:d,children:d?e.jsx(v,{className:"spinner"}):"Save Changes"})]})]})]})}),B&&a&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"Confirm Deletion"}),e.jsxs("p",{children:["Are you sure you want to delete the user ",e.jsx("strong",{children:a.username||a.displayName}),"?"]}),e.jsx("p",{children:"This action cannot be undone. All user data will be permanently removed."}),a.role==="admin"&&e.jsxs("div",{className:"warning-message",children:[e.jsx(I,{}),e.jsx("span",{children:"Warning: You are about to delete an admin user!"})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>y(!1),children:"Cancel"}),e.jsx("button",{className:"btn-danger",onClick:J,disabled:d,children:d?e.jsx(v,{className:"spinner"}):"Delete"})]})]})}),W&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content notification-modal",children:[e.jsxs("h2",{children:[j==="weeklyUpdates"&&e.jsxs(e.Fragment,{children:[e.jsx(he,{})," Send Weekly Update"]}),j==="newAgents"&&e.jsxs(e.Fragment,{children:[e.jsx(me,{})," Send New Agents Notification"]}),j==="newTools"&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{})," Send New Tools Notification"]})]}),e.jsxs("p",{className:"selected-users-count",children:["Sending to ",x.length," selected user",x.length!==1?"s":""]}),e.jsxs("form",{onSubmit:ae,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"notificationTitle",children:"Email Subject"}),e.jsx("input",{type:"text",id:"notificationTitle",value:m.title,onChange:s=>w({...m,title:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"notificationMessage",children:"Email Message"}),e.jsx("textarea",{id:"notificationMessage",value:m.message,onChange:s=>w({...m,message:s.target.value}),rows:6,required:!0}),e.jsx("p",{className:"form-helper-text",children:"This will be sent to all selected users who have enabled the corresponding notification preference."})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>A(!1),disabled:U,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:U,children:U?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"spinner"})," Sending..."]}):e.jsx(e.Fragment,{children:"Send Notification"})})]})]})]})})]})})};export{Ce as default};
