import{ba as d,bd as i,aE as g,bj as p}from"./index-CDuOHj3I.js";const h=async(e,r=null)=>{try{console.log("[API] Creating new AI tool:",e);const o=d.currentUser;if(!o)throw console.error("[API] No authenticated user found"),new Error("Authentication required. Please log in.");console.log("[API] Current user:",o.email);const s=await o.getIdToken(!0);if(!s)throw console.error("[API] Failed to get auth token"),new Error("Authentication required. Please log in.");const a={...e};if(Array.isArray(a.tags)?a.tags=a.tags.map(t=>String(t)):a.tags=[],r){const t=new FormData;Object.keys(a).forEach(n=>{n==="tags"&&Array.isArray(a[n])?a[n].forEach(l=>{t.append("tags",l)}):t.append(n,a[n])}),t.append("image",r),console.log("[API] Sending request with FormData and token:",s.substring(0,10)+"...");const c=await i.post("/api/ai-tools",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${s}`}});return console.log("[API] Response received:",c.status,c.data),c.data?.data||c.data}else{console.log("[API] Sending JSON request with token:",s.substring(0,10)+"...");const t=await i.post("/api/ai-tools",a,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});return console.log("[API] Response received:",t.status,t.data),t.data?.data||t.data}}catch(o){throw console.error("Error creating AI tool:",o),o.response&&(console.error("Response error data:",o.response.data),console.error("Response error status:",o.response.status),console.error("Response error headers:",o.response.headers)),o}},A=async(e,r,o=null)=>{try{console.log(`[API] Updating AI tool ${e}:`,r);const s=await d.currentUser?.getIdToken(!0);if(!s)throw new Error("Authentication required. Please log in as an admin.");const a={...r};if(Array.isArray(a.tags)?a.tags=a.tags.map(t=>String(t)):a.tags=[],o){const t=new FormData;Object.keys(a).forEach(n=>{n==="tags"&&Array.isArray(a[n])?a[n].forEach(l=>{t.append("tags",l)}):t.append(n,a[n])}),t.append("image",o);const c=await i.put(`/api/ai-tools/${e}`,t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${s}`}});return c.data?.data||c.data}else{const t=await i.put(`/api/ai-tools/${e}`,a,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});return t.data?.data||t.data}}catch(s){throw console.error(`Error updating AI tool ${e}:`,s),s}},I=async e=>{try{console.log(`[API] Deleting AI tool ${e}`);const r=await d.currentUser?.getIdToken(!0);if(!r)throw new Error("Authentication required. Please log in as an admin.");return{success:!0,message:"AI tool deleted successfully",...(await i.delete(`/api/ai-tools/${e}`,{headers:{Authorization:`Bearer ${r}`}})).data}}catch(r){return console.error(`Error deleting AI tool ${e}:`,r),{success:!1,error:r.message||"Failed to delete AI tool"}}},f=1800*1e3,y=async(e=!1)=>{try{const r=localStorage.getItem("ai_tools_cache"),o=localStorage.getItem("ai_tools_cache_timestamp");if(!e&&r&&o){const a=parseInt(o,10);if(Date.now()-a<f)return JSON.parse(r)}const s=await g.get(`${p}/api/ai-tools`);if(s.data&&s.data.data){const a=s.data.data.map(t=>{const c=t.image&&!t.image.includes("/undefined")&&t.image!=="/uploads/undefined"?m(t.image):"";return{...t,image:c,tags:Array.isArray(t.tags)?t.tags:t.tags?[t.tags]:[]}});return localStorage.setItem("ai_tools_cache",JSON.stringify(a)),localStorage.setItem("ai_tools_cache_timestamp",Date.now().toString()),a}return[]}catch(r){console.error("Error fetching AI tools:",r);const o=localStorage.getItem("ai_tools_cache");if(o)return JSON.parse(o);throw r}},m=e=>!e||e==="/uploads/undefined"||e.includes("/undefined")||e===""?"":e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("/")?`${p}${e}`:e,T=async(e,r)=>{try{const o=await h(e,r);return u(),o}catch(o){throw console.error("[AIToolsService] Error adding AI tool:",o),o}},S=async(e,r,o)=>{try{const s=await A(e,r,o);return u(),s}catch(s){throw console.error(`[AIToolsService] Error updating AI tool ${e}:`,s),s}},_=async e=>{try{return await I(e),u(),!0}catch(r){throw console.error(`[AIToolsService] Error deleting AI tool ${e}:`,r),r}},u=()=>{try{localStorage.removeItem("ai_tools_cache"),localStorage.removeItem("ai_tools_cache_timestamp")}catch(e){console.error("[AIToolsService] Error invalidating cache:",e)}};export{T as a,_ as d,y as g,S as u};
