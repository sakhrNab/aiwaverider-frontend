import{r as l,A as N,D as T,aA as v,j as e,ba as M,bb as w}from"./index-CDuOHj3I.js";import{R as L}from"./RichTextEditor-DhDbze3n.js";import{p as g}from"./purify.es-DxJI3Wx7.js";import{C as H}from"./categories-DXhb4QT0.js";import"./MenuBar-Np-EM3wI.js";const k=()=>{const[t,c]=l.useState({title:"",description:"",category:"Trends",image:null,additionalHTML:"",graphHTML:""}),[p,s]=l.useState(""),[u,x]=l.useState(""),{user:h,token:b}=l.useContext(N),y=T(),{addPostToCache:j}=l.useContext(v),d=r=>{const{name:n,value:i,files:m}=r.target;if(n==="image"){const a=m[0];if(a&&a.size>5*1024*1024){s("Image size should not exceed 5MB.");return}c(o=>({...o,image:a})),s("")}else c(a=>({...a,[n]:i}))},f=(r,n)=>{c(i=>({...i,[r]:n}))},C=async r=>{if(r.preventDefault(),!M.currentUser){s("You must be logged in to create a post.");return}try{if(h.role!=="admin"){s("Only admins can create posts.");return}}catch{s("Authentication Error")}if(!t.title||!t.description||!t.category){s("Title, Description, and Category are required.");return}const i=g.sanitize(t.additionalHTML),m=g.sanitize(t.graphHTML),a=new FormData;a.append("title",t.title),a.append("description",t.description),a.append("category",t.category),a.append("additionalHTML",i),a.append("graphHTML",m),t.image&&a.append("image",t.image);try{const o=await w(a,b);o.post?(j(o.post),x("Post created successfully!"),c({title:"",description:"",category:"Trends",image:null,additionalHTML:"",graphHTML:""}),s(""),setTimeout(()=>{y(`/posts/${o.post.id}`)},1500)):s(o.error||"Failed to create post.")}catch(o){console.error("Create Post Error:",o),s("An unexpected error occurred.")}};return e.jsxs("div",{className:"p-8 max-w-5xl mx-auto",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Create a New Post"}),u&&e.jsx("p",{className:"text-green-600 text-center font-semibold mb-4",children:u}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700",children:"Title"}),e.jsx("input",{type:"text",name:"title",value:t.title,onChange:d,className:"mt-1 w-full p-2 border border-gray-300 rounded-md",placeholder:"Enter post title",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700",children:"Description"}),e.jsx("textarea",{name:"description",value:t.description,onChange:d,className:"mt-1 w-full p-2 border border-gray-300 rounded-md",placeholder:"Enter post description",rows:"4",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700",children:"Category"}),e.jsx("select",{name:"category",value:t.category,onChange:d,className:"mt-1 w-full p-2 border border-gray-300 rounded-md",required:!0,children:H.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700",children:"Image (Optional)"}),e.jsx("input",{type:"file",name:"image",accept:"image/*",onChange:d,className:"mt-1 w-full p-2 border border-gray-300 rounded-md"}),t.image&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-gray-700",children:"Image Preview:"}),e.jsx("img",{src:URL.createObjectURL(t.image),alt:"Preview",className:"h-40 w-full object-cover rounded-md"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700",children:"Additional Content (Optional)"}),e.jsx(L,{content:t.additionalHTML,onChange:r=>f("additionalHTML",r)})]}),p&&e.jsx("p",{className:"text-red-500",children:p}),e.jsx("button",{type:"submit",className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Create Post"})]})]})};export{k as default};
