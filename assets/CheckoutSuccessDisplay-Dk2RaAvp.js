import{r as n,s as Q,D as ee,aV as I,j as e,ay as o,aW as U,aX as P,H as $,aY as v,aZ as T,a_ as se}from"./index-CDuOHj3I.js";import{P as te}from"./PaymentSuccessRecommendations-BnoR_Hcy.js";import"./blur-ezPV0XHg.js";const me=()=>{const p=n.useRef(null),[y,d]=n.useState("processing"),[r,g]=n.useState(null),[L,c]=n.useState(!0),[C,O]=n.useState(null),[k,A]=n.useState("card"),[j,F]=n.useState(!1),[q,M]=n.useState([]),[N,W]=n.useState([]),[i,H]=n.useState("card"),[l,z]=n.useState(""),[ne,u]=n.useState(""),[re,h]=n.useState("text-blue-600"),[oe,V]=n.useState(null),[f,E]=n.useState({}),[ce,B]=n.useState(!1),[ie,J]=n.useState([]),Y=Q(),D=ee();n.useEffect(()=>{try{const t=sessionStorage.getItem("downloadTemplates"),a=sessionStorage.getItem("orderReference"),s=sessionStorage.getItem("confirmationEmail");if(s&&E(m=>({...m,confirmationEmail:s})),t){const m=JSON.parse(t);W(m),a&&!r&&g(a)}}catch(t){console.error("Error loading template download data:",t)}},[r]),n.useEffect(()=>{const t=new URLSearchParams(Y.search),a=t.get("payment_id"),s=t.get("type")||"payment_intent",m=t.get("status"),b=t.get("simulated")==="true",S=t.get("order_id");F(b),A(s==="sepa_credit_transfer"?"sepa":"card"),H(s),z(a),S&&g(S);try{const x=localStorage.getItem("lastPurchasedItems");x&&M(JSON.parse(x))}catch(x){console.error("Error loading purchased items:",x)}const G=()=>{const x=new Date().getTime(),K=Math.random().toString(36).substring(2,8).toUpperCase();return`ORD-${x.toString().substring(6)}${K}`};a&&(m==="success"||m==="pending"||b)?b?(d("succeeded"),g(a),c(!1),I.success(e.jsxs("div",{children:[e.jsx("strong",{children:"SEPA Credit Transfer Initiated!"}),e.jsx("p",{children:"Your order has been processed in simulation mode."})]}),{duration:6e3,icon:e.jsx(o,{icon:U}),id:"sepa-simulation-toast"})):a==="unknown"&&S?(d("succeeded"),c(!1),I.success(e.jsxs("div",{children:[e.jsx("strong",{children:"Thank you for your purchase!"}),e.jsx("p",{children:"Your agent template has been sent to your email."})]}),{duration:6e3,icon:e.jsx(o,{icon:P}),id:"email-delivery-toast"})):a==="unknown"?(d("succeeded"),g(G()),c(!1),I.success(e.jsxs("div",{children:[e.jsx("strong",{children:"Thank you for your purchase!"}),e.jsx("p",{children:"Your agent template has been sent to your email."})]}),{duration:6e3,icon:e.jsx(o,{icon:P}),id:"email-delivery-toast"})):S?(d("succeeded"),c(!1)):w():(c(!1),O("Invalid payment information"))},[Y]);const w=n.useCallback(async()=>{try{if(l==="unknown"&&r){d("succeeded"),u("Your payment has been confirmed and your order is complete!"),h("text-green-600"),c(!1),clearInterval(p.current);return}if(i==="payment_intent"&&r&&y==="processing"){d("succeeded"),u("Your payment has been confirmed and your order is complete!"),h("text-green-600"),clearInterval(p.current);return}let t;if(i==="sepa_credit_transfer")t=`/api/payments/sepa-credit-transfer/${l}`;else if(i==="crypto")t=`/api/payments/crypto/${l}`;else if(i.startsWith("stripe")||l.startsWith("pi_"))t=`/api/payments/stripe/${l}`;else{r&&(d("succeeded"),u("Your payment has been confirmed and your order is complete!"),h("text-green-600")),c(!1);return}const a=await fetch(`${t}`),s=await a.json();if(!a.ok){console.error("Payment status check failed:",s.error),c(!1);return}d(s.status),c(!1),s.status==="completed"||s.status==="successful"||s.status==="succeeded"?(u("Your payment has been confirmed and your order is complete!"),h("text-green-600"),clearInterval(p.current),s.templates&&s.templates.length>0&&(J(s.templates),B(!0))):s.status==="processing"?(u("Your payment is being processed. This typically takes a few moments..."),h("text-blue-600")):s.status==="pending"?(i==="sepa_credit_transfer"?(u("Your bank transfer is pending. Please complete the transfer using the bank details below."),V(s.bankDetails)):u("Your payment is pending confirmation..."),h("text-yellow-600")):(s.status==="failed"||s.status==="canceled")&&(u("Your payment could not be processed. Please try again or contact support."),h("text-red-600"),clearInterval(p.current)),s.stripeStatus&&E(m=>({...m,stripeStatus:s.stripeStatus,lastUpdated:s.lastUpdated}))}catch(t){console.error("Error checking payment status:",t),c(!1)}},["",l,i,r]);n.useEffect(()=>{if(l&&!j&&(i==="sepa_credit_transfer"||i.startsWith("stripe")))return w(),p.current=setInterval(w,1e4),()=>{p.current&&clearInterval(p.current)};c(!1)},[w,l,j,i]);const _=()=>{D("/agents")},X=()=>{D(`/account/orders/${r}`)},R=()=>!N||N.length===0?null:e.jsxs("div",{className:"download-templates-section",children:[e.jsx("h3",{children:"Your Templates Are Ready"}),e.jsx("p",{children:"You can download your purchased templates immediately:"}),e.jsx("div",{className:"template-download-buttons",children:N.map((t,a)=>e.jsxs("a",{href:`${t.downloadUrl}&format=download`,className:"download-template-button",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(o,{icon:se,className:"download-icon"}),"Download: ",t.agentName||`Template ${a+1}`]},a))}),e.jsx("p",{className:"download-note",children:"Your download links will also be sent to your email and remain active for 30 days."})]}),Z=()=>{if(!l)return null;if(r&&k!=="sepa"&&(i==="payment_intent"||!i))return e.jsxs("div",{className:"payment-status-indicator status-success",children:[e.jsx("div",{className:"status-icon-container",children:e.jsx(o,{icon:T,className:"status-icon success"})}),e.jsxs("div",{className:"status-text",children:["Payment Successful",e.jsx("span",{className:"status-time",children:new Date().toLocaleTimeString()})]})]});let t,a,s;switch(y){case"succeeded":case"completed":case"successful":t=e.jsx(o,{icon:T,className:"status-icon success"}),a="Payment Successful",s="status-success";break;case"processing":t=e.jsx($,{color:"#4299e1",size:24}),a="Processing Payment",s="status-processing";break;case"requires_payment_method":case"requires_confirmation":case"requires_action":t=e.jsx(o,{icon:v,className:"status-icon warning"}),a="Action Required",s="status-warning";break;case"failed":case"canceled":t=e.jsx(o,{icon:v,className:"status-icon error"}),a="Payment Failed",s="status-error";break;default:t=e.jsx(o,{icon:v,className:"status-icon"}),a="Unknown Status",s="status-unknown"}return e.jsxs("div",{className:`payment-status-indicator ${s}`,children:[e.jsx("div",{className:"status-icon-container",children:t}),e.jsxs("div",{className:"status-text",children:[a,e.jsx("span",{className:"status-time",children:f.lastUpdated?new Date(f.lastUpdated).toLocaleTimeString():new Date().toLocaleTimeString()})]})]})};return e.jsx("div",{className:"checkout-success-container",children:e.jsx("div",{className:"checkout-success-card",children:L?e.jsxs("div",{className:"checkout-success-loading",children:[e.jsx($,{color:"#4FD1C5",size:60,speedMultiplier:.8}),e.jsx("p",{className:"mt-4",children:"Processing your order..."})]}):C?e.jsxs("div",{className:"checkout-error",children:[e.jsx(o,{icon:v,size:"3x",className:"error-icon"}),e.jsx("h2",{children:"Oops! Something went wrong"}),e.jsx("p",{children:C}),e.jsx("button",{className:"primary-button",onClick:_,children:"Return to Home"})]}):e.jsxs("div",{className:"checkout-success-content",children:[e.jsx(o,{icon:T,size:"3x",className:"success-icon"}),k!=="sepa"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Thank you for your purchase!"}),e.jsxs("p",{children:["Your order ",y==="succeeded"||y==="completed"?"has been completed":"is being processed","."]}),Z(),r&&e.jsxs("div",{className:"order-info",children:[e.jsxs("p",{children:["Order ID: ",e.jsx("strong",{children:r})]}),f.confirmationEmail&&e.jsxs("p",{children:["Confirmation sent to: ",e.jsx("strong",{children:f.confirmationEmail})]})]}),R(),e.jsxs("div",{className:"email-notification",children:[e.jsx(o,{icon:P,className:"email-icon"}),e.jsxs("div",{children:[e.jsx("h3",{children:"Check Your Email"}),e.jsx("p",{children:"We've sent your AI agent template to your email address. If you don't see it, please check your spam folder."})]})]}),y==="failed"&&e.jsxs("div",{className:"payment-error-help",children:[e.jsx("h3",{children:"Having trouble with your payment?"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Check your card details and try again"}),e.jsx("li",{children:"Contact your bank to make sure there are no restrictions"}),e.jsx("li",{children:"Try a different payment method or card"}),e.jsx("li",{children:"Contact our support team for assistance"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Thank you for your purchase!"}),e.jsx("p",{children:j?"Your SEPA Credit Transfer has been simulated successfully.":"Your payment request has been sent to your bank for processing."}),r&&e.jsxs("div",{className:"order-info",children:[e.jsxs("p",{children:["Payment Reference: ",e.jsx("strong",{children:r})]}),f.confirmationEmail&&e.jsxs("p",{children:["Confirmation sent to: ",e.jsx("strong",{children:f.confirmationEmail})]})]}),R(),e.jsxs("div",{className:"sepa-notification",children:[e.jsx(o,{icon:U,className:"sepa-icon"}),e.jsxs("div",{children:[e.jsx("h3",{children:"SEPA Payment Information"}),e.jsx("p",{children:j?"This is a simulated payment for testing purposes. In a real transaction, your bank would process the payment within 1-2 business days.":"SEPA Credit Transfers typically take 1-2 business days to complete. You will receive confirmation when the payment is processed."})]})]})]}),e.jsxs("div",{className:"next-steps",children:[e.jsx("h3",{children:"What's Next?"}),e.jsx("ul",{children:k==="sepa"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"Your order will be processed once payment is confirmed"}),e.jsx("li",{children:"You'll receive an email with your purchase details"}),e.jsx("li",{children:"If you have questions, please contact our support team"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"Download your agent template from your email"}),e.jsx("li",{children:"Follow the instructions to start using your new AI agent"}),e.jsxs("li",{children:["If you need help, contact our support team at ",e.jsx("a",{href:"mailto:support@aiwaverider.com",children:"support@aiwaverider.com"})]})]})})]}),e.jsx("div",{className:"success-recommendations-section",children:e.jsx(te,{purchasedItems:q,currency:"EUR",limit:3})}),e.jsxs("div",{className:"checkout-success-actions",children:[r&&!j&&e.jsx("button",{className:"secondary-button",onClick:X,children:"View Order"}),e.jsx("button",{className:"primary-button",onClick:_,children:"Continue Shopping"})]})]})})})};export{me as default};
